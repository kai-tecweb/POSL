# 投稿の多様性を改善するガイド

**作成日**: 2025年11月20日  
**目的**: 同じような投稿が繰り返される問題を解決するための改善ガイド

## 🔍 問題の原因

### 1. テンプレートIDの不一致
**問題**: データベースには `daily_reflection`, `learning_insight` などのテンプレートIDが設定されているが、コードでは `empathy_start`, `punch_line` などのIDを期待している。

**影響**: テンプレート構造の説明が生成されず、AIが同じパターンで投稿を生成してしまう。

### 2. 日記データが少ない
**問題**: 最近の日記が2件しかなく、内容も似ている。

**影響**: 日記から得られる情報が限られ、投稿のバリエーションが少なくなる。

### 3. トレンド情報が古い
**問題**: トレンド情報が11月18日のもので、更新されていない。

**影響**: 同じトレンド情報が使われ続け、投稿内容が似てしまう。

### 4. 投稿履歴の参照が不十分
**問題**: 最近の投稿履歴を参照して類似を避ける機能は実装されているが、プロンプトの最後に配置されているため、効果が弱い。

**影響**: AIが以前の投稿を十分に意識せず、同じような内容を生成してしまう。

### 5. 曜日テーマが固定されている
**問題**: 曜日テーマが設定されているが、同じテーマが繰り返し使われている可能性がある。

**影響**: 同じテーマで投稿が生成され、内容が似てしまう。

## 💡 改善策

### 改善策1: テンプレートIDのマッピングを修正

データベースのテンプレートIDとコードのテンプレートIDを一致させる必要があります。

**対応方法**:
1. データベースのテンプレートIDを確認
2. コードのテンプレート構造定義にマッピングを追加
3. または、データベースのテンプレートIDをコードに合わせて変更

### 改善策2: 日記データを増やす

**対応方法**:
1. 音声日記機能を使って、毎日異なる内容の日記を追加
2. 日記の内容を多様化（仕事、趣味、学習、日常など）
3. 日記から得られる情報が増えると、投稿のバリエーションが増える

### 改善策3: トレンド情報を更新する

**対応方法**:
1. トレンド取得APIを定期的に実行
2. トレンド情報をデータベースに保存
3. 最新のトレンド情報を使用して投稿を生成

### 改善策4: 投稿履歴の参照を強化

**対応方法**:
1. 投稿履歴の参照をプロンプトの最初の方に配置
2. 「以前の投稿と完全に異なる視点で」という指示を強化
3. 最近10件の投稿を参照するように変更

### 改善策5: 曜日テーマを多様化する

**対応方法**:
1. 曜日テーマの設定を確認
2. 各曜日のテーマを多様化
3. 同じテーマが繰り返されないようにする

### 改善策6: プロンプトに多様性を確保する指示を追加

**対応方法**:
1. システムプロンプトに「毎回異なる視点や表現で投稿を作成する」という指示を追加
2. ユーザープロンプトに「以前の投稿とは完全に異なる内容で」という指示を追加
3. テンプレートをランダムに選択する機能を強化

## 🛠️ 実装すべき改善

### 優先度: 高

1. **テンプレートIDのマッピング修正**
   - データベースのテンプレートIDとコードのテンプレートIDを一致させる
   - テンプレート構造の説明が正しく生成されるようにする

2. **投稿履歴の参照を強化**
   - 最近10件の投稿を参照
   - プロンプトの最初の方に配置
   - 「以前の投稿と完全に異なる視点で」という指示を強化

3. **プロンプトに多様性を確保する指示を追加**
   - システムプロンプトに「毎回異なる視点や表現で投稿を作成する」という指示を追加
   - ユーザープロンプトに「以前の投稿とは完全に異なる内容で」という指示を追加

### 優先度: 中

4. **日記データを増やす**
   - 音声日記機能を使って、毎日異なる内容の日記を追加
   - 日記の内容を多様化

5. **トレンド情報を更新する**
   - トレンド取得APIを定期的に実行
   - 最新のトレンド情報を使用

6. **曜日テーマを多様化する**
   - 各曜日のテーマを多様化
   - 同じテーマが繰り返されないようにする

## 📊 期待される効果

これらの改善により、以下の効果が期待されます：

1. **投稿内容の多様化**: 同じテーマやキーワードが繰り返されなくなる
2. **表現のバリエーション増加**: 異なる視点や表現で投稿が生成される
3. **投稿の質の向上**: より自然で魅力的な投稿が生成される

## 🎯 次のステップ

1. テンプレートIDのマッピングを修正
2. 投稿履歴の参照を強化
3. プロンプトに多様性を確保する指示を追加
4. 日記データを増やす（ユーザー側の対応）
5. トレンド情報を更新（システム側の対応）

---

**注意**: これらの改善は段階的に実装することを推奨します。一度にすべてを実装すると、予期しない問題が発生する可能性があります。

