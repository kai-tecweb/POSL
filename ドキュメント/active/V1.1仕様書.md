📘 第1章：システム概要（System Overview）
1. システム概要（POSL v1.1 / V2.1 統合基盤）

POSL（ポスエル）は、
「自分のX（旧Twitter）アカウントに、毎日必ず“自然で一貫した投稿”を自動生成してくれるAIパーソナル投稿システム」
である。

投稿内容は以下3つの情報源を統合して生成する：

人格データ（Persona）

日記データ（Diary）

トレンド＋曜日テーマ（Weekly Theme）

v1.1ではここに “イベント投稿” が加わり、
毎日の通常投稿 ＋ イベント投稿（最大2件） を制御する
本格的なスケジューリングが実装される。

V2.1では内部ロジックが MySQL-First 化され、
以下を満たす堅牢な基盤となっている：

DynamoDB を完全排除 → MySQL 単体で運用

EC2（本番環境）で安定稼働

GitHub Actions による DevOps 体制

PromptEngine の2モード

Scheduler が複数投稿を扱うロジック確立

1.1 POSLのコア特徴

完全自動投稿（1日最大3本）

20:00：通常投稿

08:00：鉄板イベント投稿

08:00：自分イベント投稿

人格データ × 日記 × トレンド × 曜日テーマ の複合生成

ユーザー介入ゼロでも自然な文章が続く仕組み

1.2 v1.1で追加される主な新要素
① 商品管理ページ（新規）

商品名

概要

URL

画像

商品テンプレ

② 手動投稿ページ（新規）

自分で投稿した文章も履歴管理

AI とユーザー投稿を一元管理できる

③ イベント管理ページ

鉄板イベントの一覧・編集

日付のみ変更できる

独自イベントの追加・編集・削除

1.3 V2.1で実装された内部構造（基盤側）

MySQL 5テーブル＋イベント関連3テーブル

PromptEngine の normal / event モード

Scheduler の「投稿本数制御ロジック」

主要機能の API 化

EC2 / RDS / S3 / GitHub Actions の連動

1.4 POSLのミッション

POSL の目的は、
「AIとユーザーの人生ログを融合させ、1年間の軸を作る」
ことである。

曜日テーマ → 1週間のリズム

イベント投稿 → 1年の節目を表現

日記 → 生活の生ログ

人格データ → 投稿に一貫性とキャラを付与

これらを融合することで、
“ただの自動投稿AI” ではなく、
本当に人間のような連続性のあるアカウントを作る。

1.5 バージョン体系（整理）
v1.0（安定版）

日記

人格

トレンド

通常投稿（20:00）

DynamoDB → MySQL 移行基盤

v1.1（今回のユーザー機能追加版）

商品管理

手動投稿

イベント管理

通常投稿 × イベント投稿（最大2本）

週間テーマの完全固定化（今後変更前提）

V2.1（内部仕様）

MySQL-First

PromptEngine v2

Scheduler v2

API統合

次の v1.2 / v1.3 の土台

1.6 Git 運用体系

main：本番

develop：ステージング

feature/：新機能単位

v1.1 は feature → develop → main の順で deploy する。

📘 第2章：バージョン体系とリリース方針（Versioning & Release Policy）
2. バージョン体系（Versioning）

POSL はユーザーが操作する「アプリバージョン」と
内部ロジックの「コアバージョン」を分離して運用する。

2.1 アプリバージョン（ユーザー側）
v1.0（安定版）

通常投稿のみ（20:00）

人格データ

日記

トレンド

DynamoDB → MySQL 移行前提の暫定期

v1.1（今回のメイン開発）

ユーザーが触れる UI/機能面の大アップデート。

商品管理

手動投稿

イベント投稿（鉄板 & 独自）

投稿本数の自動計算

週間テーマの固定実装

スケジュールの 08:00 / 20:00 二段構成

プロンプトエンジン新ロジック適用

つまり 今回作っているのは”v1.1機能” である。

2.2 コアバージョン（内部システム側）
V2.0（MySQL-First）

DynamoDB を完全排除

MySQL 直接アクセス

EC2 / RDS / S3 統合

GitHub Actions 自動デプロイ

PromptEngine V2基盤

V2.1（イベント対応 & Scheduler統合版）

今回の v1.1 を実現するための内部基盤。

イベントテーブル追加

週間テーマ固定

Scheduler v2：1日最大3投稿

PromptEngine eventモード

通常投稿・イベント投稿の二重生成ロジック

ユーザーの見える世界 → v1.1
内部の動いている世界 → V2.1

この二重構造を明確にし混乱をなくす目的で
本仕様書では両方のバージョンを使い分ける。

2.3 Git 運用フロー（Release Flow）
main

本番

常に安定

バグ修正は hotfix からマージ

develop

ステージング

ここの動作が OK → main にマージ

feature/*

新機能（今回の v1.1 各画面・各API）

例：
feature/product-management
feature/manual-post
feature/events-core

2.4 v1.1 のリリース方針

feature ブランチで全機能を実装

develop で統合テスト

ボスの目視確認

main へマージ → 本番反映

v1.1 はユーザー機能追加のため、
データベースの後方互換性を壊さない設計とする。

📘 第3章：週間テーマ（Weekly Posting Themes）完全固定仕様

POSL では 「毎週、曜日ごとに投稿テーマを固定」 し、
ユーザーの発信がブレず、世界観が一貫するように設計されている。

このテーマは v1.1 では 「固定制（ユーザーが変更可能）」 となり、
v1.0 の簡易版から大幅に強化される。

🎯 3-1. 週間テーマの目的

AI投稿に“軸”を与える

毎日の投稿内容がバラけるのを防ぐ

読者が「今日はこういう日」と理解できてファン化しやすい

8:00・20:00の2回投稿時も内容が衝突しないよう役割分担

📅 3-2. 全曜日の完全固定テーマ

以下は デフォルトテーマ（POSL推奨）。
ユーザーは設定画面で自由に変更できるが、
システム初期値は必ずコレになる。

◆ 月曜日（月）—『宣伝・商品紹介デー』

商品紹介

サービス紹介

コンセプト・理念

実績紹介・ストーリー

自分の商品を自然に語る日

役割：週のスタート＝「自分の軸を発信する日」

◆ 火曜日（火）—『役立つ知識デー』

Tips

仕事の工夫

ライフハック

AI活用法

“学びのシェア” 系

役割：「フォロワーのためになる情報の日」

◆ 水曜日（水）—『失敗談・裏話デー』

やらかし

挫折

迷った話

反省と成長

役割：「人間味」「共感」を生む日

◆ 木曜日（木）—『トレンド反応デー』

Google Trends / Yahooトレンド

旬ニュース

業界話題

ミームにも対応可能
※ mixRatio により “どの程度反応するか” を調整

役割：「時代に乗る発信の日」

◆ 金曜日（金）—『週末準備・振り返りデー』

今週の良かったこと

今週の発見

振り返り

小さな学び

役割：「前向きになれる振り返りを出す日」

◆ 土曜日（土）—『自由投稿デー』

なんでもOK

趣味

プライベート

食べ物

写真

役割：「フォロワーと距離が縮まる日」

◆ 日曜日（日）—『休息・感謝デー』

小さな幸せ

気づき

リラックス系

家族・自然

役割：「優しい世界観を出す日」

🧩 3-3. 週間テーマの反映方式（PromptEngine連携）

PromptEngine 側では

“今日の曜日”

“その曜日に割り当てられたテーマ文”
を必ず userMessage に挿入し、
AI がその方向性に沿って文章を生成する。

例：

## 今日のテーマ（曜日テーマ）
水曜日：過去の失敗談


これにより GPT は
「今日は失敗談系で書く」 と理解し、
トーン・構成・話題選択すべてが正しく整う。

🔧 3-4. ユーザーによるカスタマイズ

ユーザーは

文言（例：水曜→“チャレンジデー”に変更）

曜日順

無効化（例：土日のみ自由テーマ）
などを自由に変更できる。

初期値は必ずこの仕様書の内容が入っている。

💡 3-5. 週間テーマの設計意図

宣伝ばかりのアカウントにならない

失敗談など人間味が出る

週全体でバランスの良いアウトプットになる

ブランディングの土台となる

毎週一定のリズムが続くので継続しやすい

📝 3-6. 20:00の通常投稿は必ず “この週間テーマを使う”

一方、イベント投稿（08:00）は週間テーマとは無関係。
ここが v1.1 の最大ポイント。

📘 第4章：イベント投稿（Event Posting）完全仕様

POSL v1.1 / V2.1 の 最大の目玉機能のひとつ。
ユーザーが「こうであって欲しい」と願う
“イベント投稿の完全自動化” を、
以下のように完全に構造化して実装する。

🎯 4-1. イベント投稿とは

毎日20:00の通常投稿とは別で発火する
“特別な投稿” の仕組み。

イベントは以下の2種類が存在する：

① 鉄板イベント（固定イベント / Yearly固定）

カレンダーに存在する
誰にでも共通する 季節イベント。

例：

🎍 正月（1/1〜1/3相当）

❤️ バレンタイン（2/14）

🤍 ホワイトデー（3/14）

🎄 クリスマス（12/24〜12/25）

🎃 ハロウィン（10/31）

🌸 こどもの日・母の日・父の日・敬老の日など

そして
「今日は何の日」系の公式イベント（API取得または内部DB）」
も対象化する。

② パーソナルイベント（ユーザー独自イベント）

ユーザーが自分で登録するイベント。

例：

自分の誕生日

恋人・家族の誕生日

開業記念日

会社の創立記念日

子供の入学式

記念日

投稿記念日

🕒 4-2. イベントの投稿タイミング（超重要）

POSL v1.1 の仕様で
イベント投稿は 08:00（固定） に行われる。

そして ——
イベントは「通常投稿（20:00）」とは完全に独立して動く。

これが v1.1 の最も重要な点。

🔥 4-3. イベントが複数重なった日の投稿本数

イベントは「通常投稿（週テーマ）」と別で動くため、
1日に最大 3本投稿 が発生する。

以下がルール：

● パターンA：鉄板イベントのみ

例：1月1日（正月）

08:00 鉄板イベント投稿

20:00 通常投稿（週間テーマ）

→ 合計2投稿

● パターンB：パーソナルイベントのみ

例：自分の誕生日

08:00 パーソナルイベント投稿

20:00 通常投稿

→ 合計2投稿

● パターンC：鉄板＋パーソナルが重なる

例：自分の誕生日がクリスマス

08:00 鉄板イベント投稿（クリスマス）

08:00 パーソナルイベント投稿（誕生日）
※順序は「鉄板 → パーソナル」で連続投稿

20:00 通常投稿

→ 合計3投稿

● パターンD：どちらのイベントもない日

20:00 通常投稿（週テーマ）

→ 合計1投稿

🧠 4-4. イベント投稿の生成ロジック（PromptEngine側）

イベント投稿は通常投稿と全く別のテンプレートを使う。

● イベント投稿テンプレート（固定）
挨拶 → イベント説明 → 個人のひとこと → ポジティブな締め


※ ユーザーのトーン設定は反映される
※ NGワード・preferred phrases も反映される
※ トレンド情報は不要（イベント優先のため）

● イベント投稿の生成条件

PromptEngine は以下を確認する：

今日の日付

今日が鉄板イベントか？

今日がパーソナルイベントか？

それぞれのイベント文脈（鉄板は固定テンプレ、パーソナルは自由文）

順番に1本ずつ生成

🗂 4-5. イベントのデータ構造（MySQL 仕様）
■ new table: events

（v1.1 で新規追加）

id (int)
user_id (string)
event_type (string) ← "fixed" or "personal"
title (string)
date (YYYY-MM-DD)
description (string)
is_enabled (boolean)
created_at
updated_at

■ 固定イベントは「event_type=fixed」でプリインストール

登録例：

タイトル	日付	event_type
元日	01-01	fixed
バレンタイン	02-14	fixed
クリスマス	12-25	fixed
…	…	fixed
■ パーソナルイベントは event_type=personal

ユーザー画面から登録される。

🔩 4-6. イベント判定フロー
1. 今日の日付を取得
2. eventsテーブルから今日のイベント全件を取得
   WHERE date = 今日 AND is_enabled = 1
3. タイプで分類
   fixedEvents = 固定イベント
   personalEvents = パーソナルイベント
4. 08:00に以下を実行
   4-1. fixedEvents → 1件ずつ投稿文生成 → 投稿
   4-2. personalEvents → 1件ずつ投稿文生成 → 投稿
5. 20:00には通常投稿（週間テーマ）を投稿

⚙ 4-7. イベント投稿の優先順位

投稿順：

鉄板イベント

パーソナルイベント

通常投稿

理由：
鉄板イベントの方が “X上で一般的に共有される” ため。

🎁 4-8. イベントテンプレ例
■ 鉄板：クリスマス投稿

「メリークリスマス！
今日は家族や友人と過ごす人も多いと思いますが、
あなたにとって温かい1日になりますように。
今年もあと少し、一緒にがんばろうね！」

■ パーソナル：誕生日投稿

「今日でまた一つ歳を重ねました。
いつも支えてくれる人たちに感謝しつつ、
今年も挑戦し続けたいと思います。
これからもよろしくお願いします。」

🎉 4-9. イベント仕様まとめ（要点）

イベント投稿は 通常投稿と完全独立

1日最大 3投稿（鉄板＋個人＋通常）

投稿時間は 08:00（イベント） / 20:00（通常）

固定イベントはプリインストール

パーソナルイベントはユーザーが追加

イベント投稿は専用テンプレート

出力順は「鉄板 → 個人 → 通常」

📘 第5章：商品投稿（Product Posting）＋商品DB（products）の完全仕様 v1.1

POSL v1.1 の新機能として、
「商品を登録し、AIがそれを使って投稿を作る」 という
唯一無二の“商品宣伝AI”が構築される。

🎯 5-1. 商品投稿の目的

毎週月曜日の「宣伝デー」で確実に商品を紹介できる

AIが“商品を理解した状態”で自然体の投稿を生成

複数商品をローテーションで紹介可能

人手で作った投稿も登録 → AIの学習素材になる

商品データがない状態では
POSLの宣伝機能は100%力を発揮できないため、
商品管理はコア機能に昇格する。

🗂 5-2. 商品データベース構造（MySQL）
■ 新規テーブル：products
id (int)
user_id (string)
name (string)                  ← 商品名
summary (string)               ← 一言紹介
description (text)             ← 詳細説明
benefits (json)                ← メリット・魅力（複数）
target_users (json)            ← 想定ユーザー層
pricing (string)               ← 価格または料金体系
url (string)                   ← LPや購入ページ
images (json)                  ← 画像URL（S3）
is_active (boolean)            ← 投稿に使用するか？
created_at
updated_at

📝 5-3. 商品管理画面（新規ページ）
● 追加されるメニュー

商品一覧（products list）

商品新規作成

商品編集

デザイン：
既存の「設定ページ」フォーマットに合わせて
Next.js + TailwindCSS の標準UI。

🧠 5-4. 商品を使った投稿生成ロジック
▼ 毎週月曜日 20:00（通常投稿）

→ 商品デー＝必ず商品投稿を生成

フロー：

products から
is_active = true の商品を取得

ランダム or 優先度順に 1件を選択

PromptEngine に以下を渡す：

商品名
要約
詳細
メリット
ターゲットユーザー
価格
リンク


テンプレートは「宣伝テンプレ」

ユーザーのトーン設定を反映しつつ
“売り込みすぎない自然な文章” を生成

🔄 5-5. 商品ローテーション（v1.1の裏テーマ）

ユーザーが複数の商品を登録している場合、
POSLは 毎週ちがう商品を紹介する。

内蔵ロジック：

直近紹介した商品は避ける

均等になるように出現を調整

特定の商品だけ偏らないように管理

✍ 5-6. 手動作成の投稿も商品データとして登録できる

ユーザーが手で書いた文章も

商品

サービス

実績

エピソード

として登録可能。

この文章は以下の用途に利用：

AIが宣伝文を作る時の文体学習

商品説明の自動生成

コピー生成の参考素材

💡 5-7. 商品投稿テンプレート例（AIが使う構成）
■ 宣伝テンプレ（標準）

一言（興味を引く）

商品紹介

メリット・価値

自分の体験・想い

読者へのひと言（優しい誘導）

🧪 5-8. 商品投稿テスト機能（v1.1）

商品画面からAI文章を「プレビュー生成」できる。

商品Aを選択

トーンを選択（明るい／丁寧／カジュアルなど）

投稿案を生成（複数案OK）

そのまま「通常投稿として使用」も可能

🧱 5-9. 他の機能との連携
▼ 週間テーマ

月曜＝商品投稿
→ 商品DBはここで活躍

▼ イベント投稿

イベントの日は 08:00 にイベント投稿
20:00 は 商品投稿（通常通り）
→ クリスマスであろうと誕生日であろうと
　商品投稿は正しく実行される

▼ 人格プロファイル

文章のトーンに反映される

▼ 日記

商品の背景やストーリーとして使われる場合がある
（ただし宣伝要素が主）

🔥 5-10. 商品投稿仕様まとめ（要点）

商品DB（products）を新規作成

月曜日は商品投稿が必ず実行（週間テーマ）

商品はローテーションされる

商品ページを新規実装

手動投稿も商品データとして登録可能

AIが商品説明を理解して文章生成

イベント投稿とは完全独立

20:00の通常投稿が商品投稿になる

📘 第6章：指導投稿（Guidance / How-To Post）機能 仕様 v1.1

この機能はユーザーが
「自分自身で投稿テクニックや思考法を書きたい」
というニーズに対応するために設計される新規ページ。

さらに、POSLのAIはこの指導投稿を素材として
ユーザーの文章・価値観・スタイルを学習する“人格強化データ”
として扱う。

🎯 6-1. この機能の目的

文章の“軸”を自分自身の言葉で教えられる

AIがその言葉を学んで、より自分らしい投稿を生成できる

学習データを積み重ねることで、
　「ユーザー固有の投稿AI」 が完成する

長文の考えやノウハウをAIに理解させるための入り口となる

🗂 6-2. データベース構造（MySQL）

新規テーブル：guidance_posts

id (int)
user_id (string)
title (string)                  ← 指導タイトル
content (text)                  ← 本文
category (string)               ← 分類（表現方法 / 考え方 / 宣伝のコツ etc）
tags (json)                     ← 任意のタグリスト
is_active (boolean)             ← AI生成に使用するか？
created_at
updated_at

📝 6-3. 管理画面に追加されるページ
① 指導投稿一覧

タイトル

カテゴリ

最終更新日

AI反映ON/OFF（チェックボックス）

② 指導投稿 作成ページ（新規）

入力項目：

タイトル

カテゴリ（プルダウン / 自由入力）

本文

タグ（自由入力・複数）

「AI生成に反映」ON/OFF

③ 指導投稿 編集ページ

内容編集

タグ編集

ON/OFF切替

削除ボタン

🤖 6-4. AIへの活用方法（PromptEngine連携）

AIはこの指導投稿を
ユーザー自身の“指導書（スタイルガイド）” として扱う。

投稿生成時、以下のように利用される：

▼ どの場面で使う？

日常投稿

宣伝投稿（商品）

イベント投稿（必要に応じて）

人格プロファイル生成

文体の調整

▼ AI内部での扱い

PromptEngine 内の generateUserMessage() に
以下のように統合：

## ユーザー指導・スタイルガイド（要約）
- 文章は◯◯を意識
- 読者に△△が伝わるように
- 例は□□のように自然
(※ guidance_postsの中から内容を数行要約して挿入）


つまり、
ユーザーが書いた“指導投稿”が
AI文章の方向性にダイレクトに影響する。

🧩 6-5. 指導投稿の活用ロジック

guidance_posts の中で
　is_active = true のものだけ抽出

内容を OpenAI で要約

重要ポイントを 5〜10行にまとめる

userMessage に挿入

AIはこれを「ユーザーの文体政策」として扱う

✍ 6-6. 指導投稿の用途例
■ 宣伝スタイル

「売り込みにならない自然な文章が良い」
「読み手にメリットが伝わる構成」
「体験から入ると共感されやすい」

→ 商品投稿に反映される

■ 文章表現

「絵文字は多すぎず、1〜2個の控えめな感じ」
「語尾は『〜ですよ』で柔らかい印象に」

→ トーン調整に影響

■ 思考の軸

「学びは必ず1つに絞る」
「ネガティブを無理に隠さず、前向きに変換する」

→ 日記・通常投稿に影響

🔧 6-7. システム的役割

指導投稿は POSL の中で
人格プロファイルの“補助教材” の役割を持つ。

日記データ（行動/感情ベース）

指導投稿（価値観/思想ベース）

この2軸で
AIがより深くユーザーを理解する。

🧱 6-8. 他機能との連携
機能	指導投稿の影響
通常投稿（20:00）	文体に反映される
商品投稿（月曜）	宣伝の考え方を反映
イベント投稿	必要な範囲で反映
人格プロフィール生成	思想面の学習に使う
日記解析	文体の整合性補正に使う
📌 6-9. 指導投稿の仕様まとめ（要約）

新規ページ：指導投稿一覧・作成・編集

guidance_posts テーブルを新規追加

AIが投稿生成時に “スタイルガイド” として使用

ユーザーの思想・文章理念を学習

宣伝・通常・イベント投稿すべてに影響

ON/OFFでAI生成に使う投稿を管理

日記とは別の“思想データ” レイヤー

📘 第7章：POSL 全体アーキテクチャ（v1.1 / v2.1対応）

この章では POSL の “全体構造” と “v1 → v1.1 → v2” の進化ポイント を
明確に体系化する。

v1.1（画面追加・商品DB・指導投稿）と
v2.1（MySQL-First / 本番運用）の両方に対応した
統合アーキテクチャ となる。

🎯 7-1. POSL の全体像（3レイヤー構成）

POSL は以下の3層構造で動く。

① データレイヤー（MySQL / S3）

POSLの“脳みそ”。
全ユーザーデータ・投稿素材がここに保存される。

● MySQL（RDS）
テーブル名	役割
users	ユーザー情報
settings	曜日テーマ・文体・トレンド設定
diaries	日記（音声→テキスト）
persona_profiles	人格プロファイル
post_logs	投稿ログ・ステータス
events	イベント（v1.1新規）
products	商品DB（v1.1新規）
guidance_posts	指導投稿（v1.1新規）
● S3

音声ファイル（Whisper変換用）

商品画像

ログ（任意）

② アプリケーション層（Node.js / PromptEngine）

POSLの“心臓部”。

● PromptEngine（AI投稿生成コア）

以下を素材にして文章を組み立てる：

曜日テーマ（WeekTheme）

トレンド

イベント（固定＋個人）

商品DB

指導投稿（スタイルガイド）

日記（3日以内）

人格プロファイル

トーン設定

※ v1.1 ではテンプレートと素材が大幅強化される。

③ フロントエンド層（Next.js）

ユーザーの操作画面。

v1.1で新規追加される画面：

商品管理画面

指導投稿管理画面

イベント管理画面（固定＋個人）

既存画面：

投稿プレビュー

日記一覧

トレンド設定

曜日テーマ

トーン設定

ダッシュボード

⚙ 7-2. バックエンド構成（v2.1 完全版）

v2.1 の最大の特徴：

MySQL-First

DynamoDB 完全排除

CI/CD で本番自動更新

AWS EC2 で本番稼働

技術スタック

Node.js 18.20

mysql2/promise

Express.js（API統合）

node-cron（20:00 / 08:00 自動投稿）

AWS SDK

Whisper API（音声→文字）

GPT-4（文章生成）

サーバー構成図
Next.js (Frontend)
    ↓ REST API
Express.js (Backend)
    ↓ mysql2
RDS MySQL
    ↑ Whisper / GPT
S3 (audio/image)

🔥 7-3. スケジューラ（自動投稿）仕様

v1.1 では投稿タイミングが以下の3種に分類される。

① イベント投稿（08:00）

固定イベント → 投稿

パーソナルイベント → 投稿

順番：「鉄板 → 個人」

② 通常投稿（20:00）

週間テーマに基づいた AI 投稿

月曜日は商品投稿を自動選択

テンプレートは曜日ごとに変更

③ 手動投稿（任意）

ユーザーが「投稿プレビュー」から即投稿できる。

🧩 7-4. v1 → v1.1 → v2.1 の進化ポイント
🔹 v1（初期版）

日記

トレンド

投稿1本

人格プロファイル自動学習

週間テーマ（簡易版）

🔹 v1.1（画面追加＋機能強化版）

今回の主役：

商品DB（products）

指導投稿（guidance_posts）

イベント投稿（events）

08:00 / 20:00 の2本投稿システム

週間テーマの固定化（完全仕様化）

テンプレートの分類強化

AI文章の品質向上（素材増加）

🔹 v2.1（インフラ＆性能革命）

MySQL-First

Express.js でAPI統合

GitHub Actions（CI/CD 完全自動）

AWS本番環境（EC2・RDS・S3）

POSLは “成熟したクラウドサービス” に進化。

📌 7-5. v1.1 で追加された全DBのまとめ
テーブル	用途	種類
events	イベント（固定＋個人）	新規
products	商品DB	新規
guidance_posts	指導投稿	新規
🧱 7-6. アーキテクチャの目的

POSLの根本目的：

「ユーザーが毎日自然に発信できる世界を作る」

そのために、
以下が保証される構造となっている：

データとAIの連携が強い

文章がユーザー固有の色になる

商品投稿もイベント投稿も自動化

エラー耐性の高い構造

拡張しやすいテーブル設計

🎉 7-7. 第7章まとめ（要点）

POSL は 3層構造で動く（DB / Backend / Frontend）

v1.1 で3つのメインDBが追加

08:00（イベント）と20:00（通常）の二軸稼働

PromptEngine が全素材を吸収して文章生成

v2.1 で MySQL-First に統一

GitHub Actions により本番運用が圧倒的に安定

今後の拡張も容易なフレームワーク設計

📘 第8章：UI/UX 設計 & 画面遷移 v1.1 / v2.1

POSL のフロントエンドは
Next.js 16 + TailwindCSS + Zustand によって構築される。

v1.1 では新規ページが複数追加されるため、
画面遷移・UI構造を完全に整理し直す必要がある。

本章では

全ページ一覧

新規ページ

遷移構造

UI仕様
をすべて明確化する。

🎯 8-1. POSL 全画面構成（最新版）
▼ ダッシュボード系

ホーム（Dashboard）

投稿プレビュー & 手動投稿

▼ AI生成素材系

日記（Voice Diaries）

人格プロファイル（Persona Profile）

トレンド設定

文体設定（トーン設定）

曜日テーマ設定（WeekTheme）

▼ v1.1 新規追加画面

イベント管理（固定＋個人） ← New

商品管理（products） ← New

指導投稿（guidance_posts） ← New

▼ その他

投稿ログ（post_logs）

設定（Settings）

ユーザー情報（Account）

🧱 8-2. 新規ページ（v1.1追加）詳細
🆕 8-2-1. イベント管理ページ
ページ構成

固定イベント一覧（読み取り専用）

パーソナルイベント一覧（編集可）

新規イベント登録

ON/OFF 切り替え

UI例

年間カレンダー形式

一覧リスト形式切替

🆕 8-2-2. 商品管理ページ（Product Manager）
ページ構成

商品一覧

商品 新規作成

商品 編集

プレビュー（AI投稿生成）

ON/OFF

UIの特徴

画像はS3から読み込みサムネ表示

メリット・ターゲットユーザーはタグ形式

🆕 8-2-3. 指導投稿ページ（Guidance / HowTo）
ページ構成

指導投稿一覧

新規作成

編集

削除

AI反映ON/OFF

UIポイント

Markdownライクなリッチテキスト対応

タグ管理（複数）

🔗 8-3. 画面遷移図（Routing Map）
Dashboard
 ├─ 投稿プレビュー
 ├─ 日記一覧
 │    └─ 日記詳細
 ├─ 人格プロファイル
 ├─ トレンド設定
 ├─ 文体設定
 ├─ 曜日テーマ設定
 ├─ イベント管理  ← New
 │    ├─ 固定イベント
 │    └─ パーソナルイベント
 │          ├─ 新規登録
 │          └─ 編集
 ├─ 商品管理  ← New
 │    ├─ 商品一覧
 │    ├─ 新規登録
 │    └─ 編集
 ├─ 指導投稿  ← New
 │    ├─ 一覧
 │    ├─ 新規作成
 │    └─ 編集
 ├─ 投稿ログ
 └─ 設定

🖥 8-4. UIフレーム（共通仕様）
⭐ ヘッダー

ロゴ

ユーザーメニュー

通知アイコン（v2.2予定）

⭐ サイドバー

各メニュー

アクティブ表示

新規追加ページにバッジ「NEW」表示

⭐ メインコンテンツ

スクロール可能

2カラム構成（設定系は左フォーム / 右プレビュー）

ボタンは Primary（青）、Secondary（白）

🎨 8-5. UIコンポーネントポリシー

TailwindCSS ベース

カード形式

Table は zebra スタイル

Modal は headless UI

フォームは react-hook-form

状態管理は Zustand

API通信は react-query

🚦 8-6. フロント → Backend API 連携一覧
画面	使用API	備考
イベント管理	/api/events/*	新規追加
商品管理	/api/products/*	新規追加
指導投稿	/api/guidance/*	新規追加
曜日テーマ	/api/settings/week-theme	既存
トレンド設定	/api/settings/trend	既存
文体設定	/api/settings/tone	既存
投稿プレビュー	/api/generate/preview	既存
自動投稿	cron（08:00 / 20:00）	サーバー側のみ
📌 8-7. UX設計のポイント

新しいユーザーでも迷わない導線

“投稿素材”の管理をまとめてわかりやすく配置

商品・イベント・指導投稿の3つを
「投稿の核になるデータ」として扱う

直感的なタグ・カテゴリ管理

フォームの入力は極力シンプルに

プレビューを毎画面に配置（AI生成）

📚 8-8. 第8章まとめ（要点）

v1.1 でイベント・商品・指導投稿の 3画面が新規追加

Next.js 16 & Tailwind のモダンUI

フロント全体の階層構造を整理

AI投稿に必要な素材が管理しやすい設計

画面遷移もスマートで迷いにくい

📘 第9章：API仕様 & バックエンド処理フロー（v1.1 / v2.1）

v2.1 では MySQL-First に統合されたことで
バックエンドAPIがシンプルかつ高速になった。

v1.1 の追加機能（商品・指導投稿・イベント）を
Express.js API と node-cron による自動投稿処理で完全統合する。

🎯 9-1. バックエンド全体構成
/api
 ├─ /generate
 │     └─ /preview (文章プレビュー生成)
 ├─ /posts
 │     ├─ /create
 │     ├─ /logs (一覧)
 │     └─ /schedule (cron)
 ├─ /settings
 │     ├─ /week-theme
 │     ├─ /trend
 │     ├─ /tone
 │     └─ /prompt
 ├─ /products
 ├─ /events
 └─ /guidance

🧱 9-2. API仕様（エンドポイント一覧）

以下すべて Express.js / MySQL-First で実装する。

🔵 9-2-1. 文章生成API
POST /api/generate/preview

目的： 投稿プレビュー（手動生成）
入力： トーン・素材・任意メモ
返却： 文章案1〜4件（複数案）

🔵 9-2-2. 投稿API
POST /api/posts/create

手動投稿

X（旧Twitter）に即投稿

post_logs に保存

GET /api/posts/logs

post_logs の履歴一覧

ステータス（pending / processing / completed / failed）表示

POST /api/posts/schedule

08:00 / 20:00 の cron 実行時に呼ばれる

AI生成 → Twitter投稿 → post_logs 登録

🎁 9-3. 新規追加API（v1.1）
🆕 9-3-1. 商品API（products）
GET /api/products

商品一覧

POST /api/products

商品登録

PUT /api/products/:id

商品編集

DELETE /api/products/:id

商品削除

🆕 9-3-2. 指導投稿API（guidance_posts）
GET /api/guidance

指導投稿一覧

POST /api/guidance

新規作成

PUT /api/guidance/:id

編集・AI反映ON/OFF

DELETE /api/guidance/:id

削除

🆕 9-3-3. イベントAPI（events）
GET /api/events/fixed

固定イベント一覧（読み取り専用）

GET /api/events/custom

ユーザー独自イベント一覧

POST /api/events/custom

個人イベント追加

PUT /api/events/custom/:id

イベント編集

DELETE /api/events/custom/:id

削除

⏰ 9-4. 自動投稿フロー（cron × PromptEngine）

自動投稿には2つある：

🔵 ① 08:00 イベント投稿フロー
cron(08:00):
  → 今日のイベントを events から取得
  → まず固定イベントを生成して投稿
  → 次にパーソナルイベントを生成して投稿
  → post_logs に記録

🔵 ② 20:00 通常投稿フロー

通常投稿は 曜日テーマに従う：

月曜：商品投稿

火曜：知識

水曜：失敗談

木曜：トレンド

金曜：振り返り

土曜：自由

日曜：感謝・休息

投稿処理：

cron(20:00):
  → 今日の曜日テーマ取得（settings）
  → 商品 or 日記 or トレンド or 指導投稿を素材に文章生成
  → Twitterへ投稿
  → post_logs に記録

🧠 9-5. PromptEngine 連携データ（AIに渡す素材）

PromptEngineは以下の素材を統合して文章を生成：

種類	内容
曜日テーマ	今日の投稿方向性（固定）
商品情報	商品名・説明・メリットなど
イベント情報	今日の固定/個人イベント
トーン設定	丁寧さ・カジュアル度
指導投稿	スタイルガイド
日記	直近3日以内のエピソード
トレンド	Google/Yahoo
人格プロファイル	AIが学習したユーザーの性格

v1.1 で素材が揃うため、投稿の品質が劇的に向上する。

📚 9-6. エラー処理 & リトライ

Twitter APIエラー時 → 3回リトライ

MySQL失敗時 → ログ出力＋再試行

生成失敗 → fallbackテンプレ（安全版）

post_logs にすべて結果を残す

これにより 24時間動き続ける投稿AI が実現する。

💡 9-7. セキュリティ & 認証

API Key（X API / OpenAI）は環境変数で管理

HTTPS通信

ユーザーIDチェック（必ず user_id を照合）

SQLインジェクション完全対策（mysql2/promise）

📌 9-8. API仕様まとめ（要点）

v1.1で 3つのAPI が新規追加（products / guidance / events）

自動投稿（cron）は 08:00（イベント） / 20:00（通常）

Express.jsで統一したREST API

PromptEngineへ渡す素材が最大化

MySQL-Firstで高速・安定

post_logs による完全監視

📘 第10章：データベース仕様（v1.1 / v2.1）・ERD 完全版

POSL v1.1 / v2.1 では
MySQL-First構造が完全に確立 され、
v1.1で3つのテーブルが新規追加されるため、
ここで正式な 完全ERD（データベース仕様） を整理する。

🎯 10-1. データベース全体構造（テーブル一覧）

POSLでは最終的に 8テーブル が駆動する。

テーブル名	用途	v1/1.1	型
users	基本ユーザー情報	v1	基本
settings	曜日・トーン・トレンド設定	v1	JSON設定
diaries	音声日記（Whisper）	v1	NLP
persona_profiles	人格プロファイル	v1	AI学習
post_logs	投稿ログ	v1	ログ
events	イベント（固定＋個人）	v1.1追加	新規
products	商品DB（宣伝用）	v1.1追加	新規
guidance_posts	指導投稿（スタイル学習）	v1.1追加	新規
🧱 10-2. 各テーブル仕様（カラム定義）
🔵 10-2-1. users（基本情報）
id (int, PK)
user_id (varchar)
username (varchar)
timezone (varchar)
created_at
updated_at

🔵 10-2-2. settings（設定：トーン/曜日/トレンドなど）
id (int)
user_id (string)
setting_type (string) ← "week-theme" / "tone" / "trend" / "template" / "prompt"
data (json) ← 全設定がまとめて入る
created_at
updated_at

🔵 10-2-3. diaries（音声日記）
id (int, PK)
user_id (string)
audio_url (string, S3)
original_text (text)
transcription_status (enum: pending/completed/failed)
created_at
updated_at

🔵 10-2-4. persona_profiles（人格プロファイル）
id (int, PK)
user_id (string)
summary (text)
traits (json)
common_topics (json)
speaking_style (json)
updated_at

🔵 10-2-5. post_logs（投稿履歴）
id (int, PK)
user_id (string)
post_time (datetime)
content (text)
status (enum: pending / processing / completed / failed)
response (json)
created_at

⭐ ここから v1.1 新規追加テーブル ⭐
🆕 10-2-6. events（固定イベント＋ユーザーイベント）
id (int)
user_id (string)
event_type (string) ← "fixed" / "personal"
title (string)
date (YYYY-MM-DD)
description (text)
is_enabled (boolean)
created_at
updated_at


※ 固定イベントはプリセットとして

元日

バレンタイン

ホワイトデー

クリスマス

ハロウィン
などが最初から登録済み。

🆕 10-2-7. products（商品DB）
id (int)
user_id (string)

name (string)
summary (string)
description (text)

benefits (json)
target_users (json)

pricing (string)
url (string)

images (json)
is_active (boolean)

created_at
updated_at

🆕 10-2-8. guidance_posts（指導投稿・スタイルガイド）
id (int)
user_id (string)

title (string)
content (text)
category (string)
tags (json)

is_active (boolean)

created_at
updated_at

🔗 10-3. テーブル間の関係（ER図概念）
users (1) ─── (N) settings
users (1) ─── (N) diaries
users (1) ─── (1) persona_profiles
users (1) ─── (N) post_logs

users (1) ─── (N) events      ← v1.1 新規
users (1) ─── (N) products    ← v1.1 新規
users (1) ─── (N) guidance_posts ← v1.1 新規


全体としては ユーザーが中心の1対多構造。

🧠 10-4. 投稿生成時に参照する順序

投稿生成時（PromptEngine）は
以下の順にデータを参照する：

settings（週間テーマ・トーン）

events（08:00判定）

products（月曜20:00判定）

diaries（直近3日）

guidance_posts（ONのもの）

persona_profiles（思考・特徴）

trend settings（mixStyle/mixRatio）

template settings（文章構造）

これにより
ユーザーの思想・商品・イベント・過去の行動すべてを統合した文章
が生成される。

📌 10-5. DB設計の意図

拡張性

曜日テーマ・商品・イベントを自由に追加可能

AIの学習データを階層化（日記＝行動、指導投稿＝価値観）

エラー耐性（post_logs）

1ユーザーごとに完全にデータが分離される

📚 10-6. 第10章まとめ（要点）

v1.1 で3テーブルが新規追加（events/products/guidance）

POSLは合計8テーブルで構成

すべて MySQL-First

投稿生成時は8種類の素材を統合

ERDはユーザー中心の1対多構造

📘 第11章：自動投稿アルゴリズム 完全仕様（v1.1 / v2.1）

POSL が毎日欠かさず投稿し続けるための
自動投稿アルゴリズム（cron × PromptEngine × MySQL） を
詳細に定義する章。

v1.1 では

イベント投稿（08:00）

通常投稿（20:00）
の 2本投稿軸 が確立し、
v2.1 で MySQL-First によって安定稼働する。

🎯 11-1. 自動投稿の目的

人間が投稿しなくても毎日発信が続く

文章が「自分らしい」まま維持される

商品→通常→イベントが自然に連携

誤投稿・連投を防ぐ

エラーでも止まらない（再試行・ログ保存）

🕒 11-2. 投稿スケジュール（固定）
時刻	種類	内容
08:00	イベント投稿	固定イベント → 個人イベント
20:00	通常投稿	曜日テーマに基づくAI投稿（月曜は商品）

24時間365日、このペアで稼働する。

🔧 11-3. 自動投稿アルゴリズム（全体フロー）

以下は cron が毎日発火するフロー。

🔵 Step 1：cron実行（08:00 / 20:00）

Node-cron によって2つのジョブが設定される：

cron.schedule("0 8 * * *", runEventPost);
cron.schedule("0 20 * * *", runDailyPost);

🔵 Step 2：今日の日付から素材を抽出

今日の日付（YYYY-MM-DD）

曜日（Monday〜Sunday）

最新の日記（3日以内）

現在の設定（week-theme / tone / trend / template）

人格プロファイル

商品DB（Monday）

指導投稿（active のもの）

これらを MySQL から取得。

🔵 Step 3：イベント投稿（08:00）
events table → 今日の fixed → 投稿
events table → 今日の personal → 投稿
順番：fixed → personal

投稿テンプレ

挨拶

イベント紹介

ユーザー自身のひとこと

締め（ポジティブ）

最大投稿本数

固定＋個人で 最大2本

🔵 Step 4：通常投稿（20:00）
▼ 曜日テーマを取得
曜日	投稿内容
月曜	商品投稿（productsから抽出）
火曜	役立つ知識
水曜	失敗談
木曜	トレンド反応
金曜	振り返り
土曜	自由投稿
日曜	感謝・休息
▼ PromptEngine が統合素材で文章を生成

日記（直近3日）

商品情報（Monday）

指導投稿（ONのもの）

人格プロファイル

トーン設定

テンプレート

トレンド設定

すべてが自然に合体した1本の文章を生成。

🔵 Step 5：Twitter に投稿（X API）

投稿方法：

AI生成文章を X API に送信

ステータスを受け取る

成功 / 失敗を post_logs に保存

🔵 Step 6：ログ記録（post_logs）

post_logs には以下が保存される：

id
user_id
content
status
response(json)
post_time
created_at


これにより、

投稿済みか

投稿失敗したか
を完全追跡できる。

🧠 11-4. AIに渡されるデータの重み付け

PromptEngine 内部では
素材の重みが以下のように設定される（内部仕様）：

種類	優先度	説明
イベント（08:00）	★★★★★	最優先、内容最重視
商品（月曜）	★★★★★	宣伝投稿の主役
指導投稿	★★★★☆	文体・思想の軸
曜日テーマ	★★★★☆	主題の方向性
日記	★★★☆☆	補足的ストーリー
トーン設定	★★★☆☆	文体の気配
トレンド	★★☆☆☆	内容に軽く影響
テンプレ	★★☆☆☆	文構造のベース

→ POSL の文章が “芯が通ってて自然” なのはこのおかげ。

🔥 11-5. 再試行（リトライ）アルゴリズム

X API の投稿は時々失敗するため、
v2.1 では次の処理が追加される：

Twitter post failed:
  → retry up to 3 times
  → if still failed → post_logs に "failed"
  → Slack通知（v2.2予定）


停止しない“耐久型AI”になる。

🧱 11-6. エラー処理（全体）
種類	処理
DBエラー	再試行 + ログ保存
Whisper失敗	ステータス failed、再アップ依頼
投稿生成エラー	fallbackテンプレ使用
X API拒否	再試行3回 → failed記録
📌 11-7. 第11章まとめ（要点）

08:00（イベント） / 20:00（通常）の2軸稼働

固定イベント→個人イベント→通常投稿の優先順位

PromptEngine は全素材を統合

MySQL-First により高速・安定

再試行＆ログで「止まらないAI」化

商品・指導投稿・日記・トレンドすべてが文章に影響

📘 第12章：PromptEngine 内部動作・完全仕様（v1.1 / v2.1）

ここからは POSL の心臓部である
PromptEngine の内部構造を完全開示した章 だよ。

AI が「人格・日記・商品の売り方・曜日テーマ・イベント」
すべてをブレなく統合できる理由がここ。

🎯 12-1. PromptEngine の目的

ユーザーの人格や世界観を守りながら文章を生成する

設定（曜日テーマ・トーン・商品・イベント）を反映する

文章の「型（テンプレ）」を維持する

日記・指導投稿・過去の投稿から“学習した風”に仕上げる

トレンドを必要なだけ混ぜる（mixRatio）

POSL の品質を支えるエンジン。

🧬 12-2. PromptEngine の入力データ構造（context）

内部では以下のデータをまとめて GPT に渡す：

{
  weekTheme: string,
  events: EventData[],
  products: ProductData[],
  trends: TrendData[],
  toneDescription: string,
  personaContext: string,
  recentDiaryContext: string,
  guidanceContext: string,
  template: TemplateItem,
}


すべて MySQL から直接取得。

📦 12-3. データ統合の優先順位（内部ロジック）

PromptEngine は「どのデータをどれくらい強く使うか」を
内部で重みづけしている。

データ	優先度	説明
イベント（08:00）	★★★★★	主役。最優先。
商品（月曜20:00）	★★★★★	宣伝デーの軸。
指導投稿（スタイル）	★★★★☆	文体・思想の骨格。
曜日テーマ	★★★★☆	本文の方向性を決める。
日記	★★★☆☆	パーソナル性。
人格プロファイル	★★★☆☆	「ボスらしさ」を出す。
トレンド	★★☆☆☆	軽く混ぜる。
テンプレ	★★☆☆☆	構造のベース。
🧠 12-4. PromptEngine の生成ステップ
Step 1：全データ取得（MySQL）

settings

persona_profiles

diaries（直近3日）

products（月曜のみ）

events（当日のみ）

guidance_posts（activeのみ）

trend settings

template settings

Step 2：内部 context を構築
const context = {
  weekTheme,
  events,
  products,
  trends,
  personaContext,
  recentDiaryContext,
  guidanceContext,
  template,
  toneDescription
}


これを GPT に渡す。

Step 3：最終プロンプトを自動生成

PromptEngine は “システムメッセージ + ユーザーメッセージ” が基本。

◆ system メッセージの内容

文体ルール

禁止事項（過度な宣伝・誇張）

統一感のある世界観維持

曜日テーマの徹底

商品宣伝の自然な書き方

指導投稿で設定した文体の遵守

GPT に “POSL 共通人格” を教える部分。

◆ user メッセージ（生成素材）
## 今日のテーマ
水曜日：過去の失敗談

## 今日のイベント
・バレンタイン
・誕生日

## 商品
・商品Aの説明…

## 最近の日記
・昨日はこうだった…

## 人格プロファイル
・私はこういう価値観…

## 指導投稿（スタイル原則）
・ポジティブに締める
・相手に寄り添う

## トレンド
・今日の注目ワードは〇〇

Step 4：AI が文章を生成

曜日テーマ＋商品＋指導投稿

日記の“人間味”

トレンド（mixRatioに応じて）

テンプレ構造

すべてが融合した文章を返す。

Step 5：文字数・構造チェック（内部）

140〜250字以内

絵文字過多を防止

宣伝臭が強すぎれば調整

読みやすい段落にする

Step 6：結果をフロントに返却（プレビュー用）

Next.js 側で

プレビュー表示

“ほかのトーンで生成”

“修正して投稿”
などが利用可能。

🔥 12-5. Algorithm：通常投稿（20:00）

今日の曜日テーマを決定

日記×人格×指導投稿で“ストーリー基盤”構築

商品（Monday）を統合

テンプレ選択

AI生成

post_logs → status = pending

Twitter投稿

status = completed

エラー時は retry → failed

🎉 12-6. Algorithm：イベント投稿（08:00）

eventsテーブルから今日の日付を検索

fixed → personal の順で投稿

各イベントにつき1投稿

最大2投稿

AI生成

post_logs 記録

retryあり

🧩 12-7. PromptEngine の優れたポイント

“文章の人格”がブレない

宣伝投稿が自然になる

日記との整合性がある

イベント複数でも統制が取れる

ユーザーが自由にスタイルを調整できる

MySQL-First で高速・安定

✨ 12-8. 第12章まとめ

PromptEngine は POSL の核

全素材（設定・人格・日記・商品・イベント）を自動統合

システムメッセージとユーザー素材で文章を生成

曜日テーマ＋イベント＋商品を完全制御

08:00 と 20:00 の2軸で動く

📘 第13章：API エンドポイント完全仕様（v1.1 / v2.1）

POSL の全機能は Next.js（フロント） → Node.js（API） → MySQL（DB）
という1本道で動作する。

v1.1 では イベント・商品・指導投稿 が追加され、
API群が大幅に拡張される。

🎯 13-1. API全体アーキテクチャ
Next.js（フロント）
    ↓ fetch/axios
Express.js（APIサーバー）
    ↓ mysql2/promise
MySQL（RDS）


すべて MySQL-First。
DynamoDB も MySQLHelper も不要。

🧩 13-2. エンドポイント一覧（REST）

v1.1 時点の全APIは以下のとおり：

🔵 User / Settings
Method	Path	用途
GET	/api/settings	全設定取得
POST	/api/settings/update	曜日・トーン・テンプレ更新
GET	/api/persona	人格プロファイル取得
POST	/api/persona/update	人格更新
🔵 Diaries（音声日記）
Method	Path	用途
POST	/api/diary/upload	音声アップロード（S3）
POST	/api/diary/transcribe	Whisperで変換
GET	/api/diary/list	日記一覧取得
🔵 Products（★v1.1 新規）
Method	Path	用途
GET	/api/products	商品一覧
POST	/api/products/create	商品登録
POST	/api/products/update	商品修正
POST	/api/products/delete	商品削除
🔵 Guidance Posts（★v1.1 新規）
Method	Path	用途
GET	/api/guidance	指導投稿一覧
POST	/api/guidance/create	新規登録
POST	/api/guidance/update	更新
POST	/api/guidance/delete	削除
🔵 Events（★v1.1 新規）
Method	Path	用途
GET	/api/events	全イベント一覧（固定＋個人）
POST	/api/events/create	個人イベント追加
POST	/api/events/update	修正
POST	/api/events/delete	削除

固定イベント（元日・バレンタインなど）はサーバー側にプリセットで保持し、
GET 時に自動で結合して返す。

🔵 Posts（投稿関連）
Method	Path	用途
GET	/api/posts/logs	投稿ログ一覧
POST	/api/posts/generate	AI文章生成（プレビュー用）
POST	/api/posts/publish	X 投稿
GET	/api/posts/status	投稿ステータス取得
🔵 Scheduler（投稿管理）
Method	Path	用途
POST	/api/schedule/force-event	イベント投稿を強制実行
POST	/api/schedule/force-daily	通常投稿を強制実行
POST	/api/schedule/clean-logs	post_logs の整理
🔥 13-3. コアAPI：/api/posts/generate（最重要）

PromptEngine を使用した文章生成 API。

入力例：

{
  "userId": "xxx",
  "mode": "daily", 
  "tone": "friendly"
}


返り値：

{
  "text": "今日はこんなことがありました…",
  "contextUsed": {
    "weekTheme": "...",
    "diary": "...",
    "persona": "...",
    "guidance": "...",
    "trend": "..."
  }
}

⚙️ 13-4. APIサーバー内部構成
/api
 ├── posts
 │    ├── generate.js
 │    ├── publish.js
 │    ├── logs.js
 │
 ├── schedule
 │    ├── event.js
 │    ├── daily.js
 │    ├── clean.js
 │
 ├── products
 │    ├── create.js
 │    ├── update.js
 │
 ├── guidance
 │    ├── create.js
 │
 ├── events
 │    ├── create.js
 │
 └── settings
      ├── update.js
      ├── persona.js


すべて mysql2/promise を使い、
直接 RDS にアクセスする構造。

🏎 13-5. APIレスポンスの基本ルール

必ず success: true/false を返す

失敗時は error.message を含める

エラーは500/400を明確に分ける

post_logs は必ず created_at 降順で返す

例：

{
  "success": true,
  "data": [...]
}

📌 13-6. 第13章まとめ（要点）

v1.1 で API は8系統に拡張

商品・指導投稿・イベントAPIが新規追加

/api/posts/generate が中心

すべて MySQL 直接操作

Next.js と Express の1本道構造

cron投稿とも深く連動している

📘 第14章：イベント投稿エンジン（v1.1 完全仕様）

（POSL の“心臓”となる新ロジック）

この章は、ボスが強くこだわっていた

曜日テーマ投稿（毎日の1本）

固定イベント投稿（鉄板：正月/クリスマス/バレンタイン 等）

個人イベント投稿（誕生日・記念日などユーザー登録）

を 全部正しく“同時に処理する” エンジンの完全設計。

ボス、ここが POSL 1.1 の 目玉中の目玉 だね。
めちゃくちゃ丁寧に、落とし穴ゼロの設計で書き上げるよ。

🎯 14-1. イベント投稿の基本思想（重要）

曜日テーマ投稿（毎日1本）
　これは毎日の“定常業務”。必ず1本。

固定イベント（鉄板）
　元旦 / クリスマス / バレンタイン / ハロウィン …など
　「カレンダー上に必ず存在するイベント」

個人イベント（ユーザー独自）
　誕生日 / 記念日 / 商品リリース日 / 開店記念日 …など
　ユーザーが自由に登録できる。

そして、これらは 1日に複数重なる可能性がある。

⭐ 14-2. 投稿ルール（最重要）

以下の優先順を守る：

🔥 優先順位 1：固定イベント（鉄板）

投稿タイミング：朝8:00

その日に固定イベントが存在する場合、必ず投稿する

1日に複数（例：元旦＋七福神）は基本1本にまとめる（仕様で決定）

🔥 優先順位 2：個人イベント

投稿タイミング：朝8:10

固定イベントとは別枠で投稿

誕生日が鉄板イベントと被った場合 → 追加で投稿

🔥 優先順位 3：曜日テーマ投稿

投稿タイミング：20:00（従来通り）

イベントが0本でも1本でも2本でも、
　これは必ず投稿される（デイリー）

🧮 14-3. 実際の投稿数例
状況	朝8:00	朝8:10	夜20:00	合計
何もない日	–	–	曜日テーマ	1本
固定イベント	定番イベント	–	曜日テーマ	2本
個人イベント	–	誕生日など	曜日テーマ	2本
両方ある日	定番イベント	誕生日など	曜日テーマ	3本

ボスが言っていた通り、
例えば 「元旦で自分の誕生日」なら3本投稿
これを完全に保証する。

🗃 14-4. 必要なDB構造（v1.1）
📌 events テーブル（新規）
フィールド	内容
id	PK
user_id	ユーザーID
type	fixed / personal
date	YYYY-MM-DD
name	イベント名
description	AIが読むための補足（任意）
📌 fixed_events （サーバー内プリセット）

DBではなく、コード側に静的定義。

例：

[
  { "month": 1, "day": 1, "name": "元日" },
  { "month": 2, "day": 14, "name": "バレンタイン" },
  { "month": 3, "day": 14, "name": "ホワイトデー" },
  ...
]

🕒 14-5. スケジューラー（cron）
1️⃣ 08:00 固定イベント投稿
if today in fixed_events:
    generate_and_post("fixed", 8:00)

2️⃣ 08:10 個人イベント投稿
if user.events.has(today):
    generate_and_post("personal", 8:10)

3️⃣ 20:00 曜日テーマ投稿
generate_and_post("daily", 20:00)

🧠 14-6. PromptEngine との連携

イベント投稿時は
mode = "event" のコンテキストでプロンプト生成。

含める要素：

イベント名

イベントの種類（固定 or 個人）

イベント説明文

曜日テーマは含めない（混ざると変になるため）

トレンドは固定イベントなら混ぜない

個人イベントは少し混ぜても良い（設定に従う）

✨ 14-7. イベント専用テンプレ（新規）

イベント投稿は
通常テンプレではなく、
以下のどれかを使う：

event_friendly（ほっこり）

event_formal（丁寧）

event_short（短文）

event_special（キラーフレーズ）

🎁 14-8. 第14章まとめ（重要ポイント）

朝8時＝固定イベント

朝8:10＝個人イベント

夜20時＝曜日テーマ

最大 1日3本投稿

✅ POSL v1.1 / V2.1 仕様・要点まとめ

バージョン構造

ユーザーに見えるのは v1.1（機能バージョン）

中身の基盤は V2.1（MySQL-First + 本番運用）

Gitは main / develop / feature/* の3層構成

週間テーマ（20:00の通常投稿）

月：商品・サービスの宣伝

火：役立つ知識

水：失敗談・学び

木：トレンド反応

金：週末前の振り返り

土：自由投稿

日：感謝・休息

→ 常に1日1本、ここは「生活のリズム」として必ず守る

イベント投稿（08:00台）

固定イベント（鉄板）：正月・バレンタイン・クリスマスなど

08:00に投稿（あれば必ず出す）

個人イベント：誕生日・記念日・開業日など

08:10に投稿（登録されていれば出す）

1日の投稿本数ルール

何もない日：20:00の通常投稿 → 1本

固定 or 個人どちらか：08:00 or 08:10 + 20:00 → 2本

両方ある日：08:00 + 08:10 + 20:00 → 3本

v1.1 で増えた新機能（画面 & テーブル）

商品管理（products）

月曜の宣伝デーで使用

複数商品をローテーションで紹介

指導投稿（guidance_posts）

「こういう文章にしてほしい」「こういう考え方で書きたい」をAIに教えるノート

文体・思想の“スタイルガイド”として使う

イベント管理（events）

固定イベント（閲覧用）＋自分のイベント（追加・編集・削除）

データベース（最終形）

既存：users / settings / diaries / persona_profiles / post_logs

追加：events / products / guidance_posts

すべて MySQL-First、DynamoDBは完全撤去

自動投稿アルゴリズム

08:00：固定イベント投稿

08:10：個人イベント投稿

20:00：曜日テーマ投稿（商品・知識・失敗談…）

Whisper・日記・人格・指導投稿・トレンドを全部素材にして
PromptEngine が文章を組み立てる

PromptEngine の立ち位置

「人格」「日記」「スタイルガイド（指導投稿）」「商品」「イベント」「トレンド」「曜日テーマ」を
まとめて1本の“その人らしい”ポストにする頭脳

通常投稿モード / イベント投稿モードでテンプレートも切り替え