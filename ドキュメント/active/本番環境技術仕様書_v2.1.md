# ğŸ— POSL V1 æœ¬ç•ªç’°å¢ƒæŠ€è¡“ä»•æ§˜æ›¸

**Version**: 2.2 (Production Release - X APIå¾©æ—§å®Œäº†)  
**Last Updated**: 2025å¹´11æœˆ18æ—¥ 15:00  
**Status**: âœ… Production Ready - å®Œå…¨é‹ç”¨å¯èƒ½

## ğŸŒ æœ¬ç•ªç’°å¢ƒURL
**ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ãƒˆ**: http://18.179.104.143/

### ä¸»è¦ãƒšãƒ¼ã‚¸
- **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**: http://18.179.104.143/dashboard
- **æŠ•ç¨¿ãƒ­ã‚°**: http://18.179.104.143/logs
- **è¨­å®šç®¡ç†**: http://18.179.104.143/settings/*

## ğŸ­ Infrastructure Architecture

### AWS EC2 (18.179.104.143)
```
â”Œâ”€ Nginx (Port 80) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€ Frontend (/) â†’ localhost:3000      â”‚
â”‚  â””â”€ Backend (/api/) â†’ localhost:3001/dev/â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€ Application Layer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€ PM2 Management                     â”‚
â”‚  â”‚  â””â”€ posl-frontend (Next.js)         â”‚
â”‚  â””â”€ Manual Backend                     â”‚
â”‚     â””â”€ serverless offline --stage dev  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### External Services
```
MySQL RDS
â”œâ”€ Host: posl-production.cxiucq08iku4.ap-northeast-1.rds.amazonaws.com
â”œâ”€ Port: 3306
â”œâ”€ Database: posl_db
â””â”€ Engine: MySQL 8.0

S3 Storage
â””â”€ Bucket: posl-audio-storage-prod-iwasaki-2024
```

## ğŸ“‹ Technical Stack

### Frontend Stack
- **Framework**: Next.js 14.2.33
- **Language**: TypeScript 5.x
- **Styling**: Tailwind CSS 3.x
- **State Management**: Zustand
- **Build Tool**: Next.js built-in Webpack
- **Process Manager**: PM2 v6.0.13

### Backend Stack
- **Runtime**: Node.js 18.x LTS
- **Framework**: Serverless Framework v3
- **Language**: TypeScript 5.x
- **Database Client**: mysql2/promise
- **Development Server**: serverless-offline
- **Stage**: dev (production deployment)

### DevOps & Infrastructure
- **Web Server**: Nginx 1.18.0 (Ubuntu)
- **Operating System**: Ubuntu 20.04 LTS
- **Process Management**: PM2 (frontend), Manual (backend)
- **SSL**: Not implemented (HTTP only)
- **Domain**: IP-based access

## ğŸ”§ Configuration Details

### Environment Variables

#### Frontend (.env.production)
```
NEXT_PUBLIC_API_URL=/api
```

#### Backend (.env)
```
NODE_ENV=production
AWS_REGION=ap-northeast-1
MYSQL_HOST=posl-production.cxiucq08iku4.ap-northeast-1.rds.amazonaws.com
MYSQL_PORT=3306
MYSQL_USER=admin
MYSQL_PASSWORD=PoSL-Prod-2024!
MYSQL_DATABASE=posl_db
S3_BUCKET_NAME=posl-audio-storage-prod-iwasaki-2024
S3_REGION=ap-northeast-1

# X (Twitter) APIè¨­å®š - 2025/11/18æ›´æ–°
X_API_KEY=5QCWQPq8qmNKaCQ0cOFW8huA1
X_API_SECRET=jwkzmRSajwKgSGX1nBwRd2kynij1r5hcISO09xMFQ0Rbm8M5bU
X_ACCESS_TOKEN=1596685990046797824-3S2urVULUQ4QADzntn2JywFnYhVT0m
X_ACCESS_TOKEN_SECRET=rd2ntsDrEf9HB4gYnItMxCt9RkLQUBWDmwYnk5MrjBeAX

# é–‹ç™ºç’°å¢ƒè¨­å®š
STAGE=local
```

### Nginx Configuration
```nginx
server {
    listen 80;
    server_name 18.179.104.143;

    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/ {
        proxy_pass http://localhost:3001/dev/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### PM2 Configuration
```bash
pm2 start npm --name "posl-frontend" -- start
pm2 save
pm2 startup
```

## ğŸ”Œ API Endpoints

### Trends API
- **GET** `/api/trends/google` - Google Trends data
- **Response**: JSON with trend data and formatted values

### Posts API  
- **GET** `/api/post/logs?limit={n}` - Post history
- **GET** `/api/post/status?limit={n}` - Post status
- **POST** `/api/test/post` - Test post creation

### Settings API
- **GET** `/api/settings/{type}` - Get settings by type
- **PUT** `/api/settings/{type}` - Update settings

### Error Logs API
- **GET** `/api/errors/logs?limit={n}` - Get error logs
- **DELETE** `/api/errors/logs` - Clear error logs

## ğŸ¨ Frontend Architecture

### Dynamic Environment Detection
```typescript
const getApiBaseUrl = () => {
  if (typeof window === 'undefined') return '/api'
  const hostname = window.location.hostname
  
  if (hostname === 'localhost' || hostname === '127.0.0.1') {
    return 'http://localhost:3001'
  } else {
    return '/api'
  }
}
```

### Page Structure
```
/app
â”œâ”€â”€ page.tsx (Landing page)
â”œâ”€â”€ dashboard/page.tsx (Main dashboard)
â”œâ”€â”€ logs/page.tsx (Post logs) â­ NEW
â”œâ”€â”€ settings/
â”‚   â”œâ”€â”€ prompt/page.tsx
â”‚   â”œâ”€â”€ tone/page.tsx
â”‚   â”œâ”€â”€ trends/page.tsx
â”‚   â””â”€â”€ [other settings]/page.tsx
â””â”€â”€ api/
    â””â”€â”€ posts/logs/route.ts (API route)
```

## ğŸ—„ï¸ Database Schema

### MySQL Tables
- **users** - User management
- **settings** - Configuration data
- **post_logs** - Post history and status
- **diaries** - Diary entries
- **persona_profiles** - AI persona data
- **error_logs** - System error tracking

## ğŸš€ Deployment Process

### Frontend Deployment
```bash
cd /home/ubuntu/POSL-repo/frontend
npm run build
pm2 restart posl-frontend
```

### Backend Deployment
```bash
cd /home/ubuntu/POSL-repo/backend
npm run build
scripts/dev-server.sh restart
```

### File Sync (Development)
```bash
rsync -avz -e "ssh -i ~/.ssh/posl-production-key.pem" \
  ./frontend/src/ ubuntu@18.179.104.143:/home/ubuntu/POSL-repo/frontend/src/
```

## ğŸ” Monitoring & Maintenance

### Process Monitoring
```bash
# PM2 Status
pm2 status
pm2 logs posl-frontend

# Backend Status
cd /home/ubuntu/POSL-repo/backend
scripts/dev-server.sh status
```

### Performance Metrics
- **Frontend Load Time**: ~1.2s
- **API Response Time**: 100-200ms
- **Build Time**: ~45s
- **Memory Usage**: 
  - Frontend: ~60MB
  - Backend: ~180MB

## ğŸ”’ Security Configuration

### Network Security
- **Firewall**: UFW enabled
- **Open Ports**: 22 (SSH), 80 (HTTP)
- **SSH**: Key-based authentication only

### Application Security
- **Environment Variables**: Secured with proper .env files
- **Database**: RDS with VPC isolation
- **API**: CORS configured for production domain

## ğŸ”„ Known Issues & Limitations

### Current Limitations
- **HTTP Only**: HTTPS not implemented
- **No Domain**: IP-based access only
- **Manual Backend**: Not PM2 managed
- **No CDN**: Direct server serving

### Future Improvements
- [ ] SSL certificate implementation
- [ ] Custom domain setup
- [ ] Backend PM2 management
- [ ] CloudFront CDN integration
- [ ] Automated monitoring alerts

## ğŸ“Š System Status

### âœ… Working Features
- [x] Dynamic environment detection
- [x] All API endpoints functional
- [x] Database connectivity stable
- [x] Frontend responsive design
- [x] PM2 process management (frontend)
- [x] Nginx reverse proxy
- [x] Build and deployment pipeline
- [x] **X APIæŠ•ç¨¿æ©Ÿèƒ½å®Œå…¨å¾©æ—§** (2025/11/18)
- [x] **è‡ªå‹•æŠ•ç¨¿ã‚·ã‚¹ãƒ†ãƒ å‹•ä½œç¢ºèª** (2025/11/18)
- [x] **MySQLçµ±åˆå‹•ä½œç¢ºèª** (2025/11/18)

### ğŸ”§ Technical Debt
- [ ] Backend process management improvement

---

## ğŸ¦ X API çµ±åˆè©³ç´° (2025/11/18 å¾©æ—§å®Œäº†)

### èªè¨¼è¨­å®š
- **èªè¨¼æ–¹å¼**: OAuth 1.0a
- **ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: twitter-api-v2 v1.15.0
- **å®Ÿè£…**: `/backend/src/libs/x-api.ts`

### æˆåŠŸæŠ•ç¨¿å±¥æ­´
| æŠ•ç¨¿ã‚¿ã‚¤ãƒ— | Tweet ID | URL | å®Ÿè¡Œæ™‚åˆ» |
|-----------|----------|-----|----------|
| ç›´æ¥ãƒ†ã‚¹ãƒˆ | 1990673704360300889 | [Link](https://x.com/posl_ai/status/1990673704360300889) | 2025/11/18 15:30 |
| è¿½åŠ ç¢ºèª | 1990675921586827731 | [Link](https://x.com/posl_ai/status/1990675921586827731) | 2025/11/18 15:33 |
| è‡ªå‹•æŠ•ç¨¿ãƒ†ã‚¹ãƒˆ | 1990676173375049952 | [Link](https://x.com/posl_ai/status/1990676173375049952) | 2025/11/18 15:59 |

### å¾©æ—§ä½œæ¥­è©³ç´°
1. **å•é¡Œ**: 401 Unauthorized ã‚¨ãƒ©ãƒ¼
2. **æ ¹æœ¬åŸå› **: å¤ã„APIã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã®ç„¡åŠ¹åŒ–
3. **è§£æ±º**: æ–°ã—ã„ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«å–å¾—ãƒ»è¨­å®š
4. **æ¤œè¨¼**: å®ŸæŠ•ç¨¿ã«ã‚ˆã‚‹å‹•ä½œç¢ºèª

### è‡ªå‹•æŠ•ç¨¿è¨­å®š
- **ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: `/scripts/auto-post.sh`
- **å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°**: 12:00 PM (cronè¨­å®šæº–å‚™å®Œäº†)
- **ãƒ†ã‚¹ãƒˆçµæœ**: âœ… æ­£å¸¸å‹•ä½œç¢ºèªæ¸ˆã¿

---

**æœ€çµ‚æ›´æ–°**: 2025å¹´11æœˆ18æ—¥ 15:00  
**æ›´æ–°ç†ç”±**: X APIæŠ•ç¨¿æ©Ÿèƒ½å®Œå…¨å¾©æ—§ã€è‡ªå‹•æŠ•ç¨¿ã‚·ã‚¹ãƒ†ãƒ å‹•ä½œç¢ºèªå®Œäº†
- [ ] Comprehensive error handling
- [ ] Performance optimization
- [ ] Security hardening
- [ ] Backup automation

---
**Document Version**: 2.1  
**Environment**: AWS EC2 Production  
**Last Verified**: 2025-11-18 00:45:00 JST