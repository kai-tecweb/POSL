# 自動投稿確認手順

**作成日**: 2025年11月20日  
**目的**: 設定時刻に投稿が実行されたか確認する手順

## 📋 確認手順

### 1. 設定時刻の確認

16:00 JST = 07:00 UTC に設定されていることを確認：

```bash
# cron設定を確認
crontab -l | grep enhanced-auto-post

# 期待される結果:
# 0 7 * * * /home/ubuntu/enhanced-auto-post.sh >> /home/ubuntu/auto-post.log 2>&1
```

### 2. 投稿ステータス確認スクリプトを実行

```bash
./scripts/check-post-status.sh
```

このスクリプトは以下を確認します：
- 現在の時刻（UTC/JST）
- cron設定
- 最近の自動投稿ログ
- 最近の投稿履歴（API経由）
- cron実行ログ
- 次の実行予定時刻

### 3. 手動確認

#### 3-1. ログファイルを確認
```bash
# リアルタイムでログを監視
tail -f /home/ubuntu/auto-post.log

# 最近のログを確認
tail -20 /home/ubuntu/auto-post.log
```

#### 3-2. 投稿履歴を確認（API経由）
```bash
# 最近の投稿履歴を取得
curl -s http://localhost:3001/api/post/logs?limit=3 | jq .

# またはブラウザで確認
# http://your-server-ip/api/post/logs?limit=3
```

#### 3-3. データベースで確認
```bash
# 最近の投稿を確認
mysql -h$MYSQL_HOST -u$MYSQL_USER -p$MYSQL_PASSWORD $MYSQL_DATABASE \
  -e "SELECT id, user_id, JSON_EXTRACT(post_data, '$.content') as content, created_at FROM post_logs ORDER BY created_at DESC LIMIT 3;"
```

### 4. cron実行ログを確認

```bash
# cron実行ログを確認
grep -i "enhanced-auto-post\|CRON.*enhanced" /var/log/syslog | tail -10

# または
sudo journalctl -u cron | grep enhanced-auto-post | tail -10
```

## 🔍 問題が発生した場合

### 投稿が実行されていない場合

1. **cron設定を確認**
   ```bash
   crontab -l | grep enhanced-auto-post
   ```

2. **検証スクリプトを実行**
   ```bash
   ./scripts/verify-cron-setup.sh
   ```

3. **手動でスクリプトを実行してテスト**
   ```bash
   /home/ubuntu/enhanced-auto-post.sh
   ```

4. **APIサーバーの状態を確認**
   ```bash
   curl http://localhost:3001/health
   pm2 status
   ```

5. **ログを確認**
   ```bash
   tail -50 /home/ubuntu/auto-post.log
   ```

### cron設定が反映されていない場合

1. **緊急修正スクリプトを実行**
   ```bash
   ./scripts/fix-cron-immediately.sh
   ```

2. **手動でcron設定**
   ```bash
   crontab -e
   # 以下を追加:
   # 0 7 * * * /home/ubuntu/enhanced-auto-post.sh >> /home/ubuntu/auto-post.log 2>&1
   ```

3. **cronサービスを再起動**
   ```bash
   sudo service cron restart
   ```

## 📊 確認チェックリスト

- [ ] cron設定が正しい（16:00 JST = 07:00 UTC）
- [ ] スクリプトが存在し、実行権限がある
- [ ] APIサーバーが起動している
- [ ] ログファイルが作成されている
- [ ] 投稿履歴に新しいエントリがある
- [ ] cron実行ログに記録がある

## 🎯 期待される動作

16:00 JST（07:00 UTC）になると：
1. cronが `enhanced-auto-post.sh` を実行
2. スクリプトがAPIサーバーに接続
3. AI投稿が生成される
4. X（Twitter）に投稿される
5. 投稿履歴がデータベースに保存される
6. ログファイルに記録される

---

**最終更新**: 2025年11月20日

