# 次期バージョン（V1.1）設計書

**作成日**: 2025-11-20  
**バージョン**: V1.1  
**ステータス**: 設計確定（現行画面は本設計に基づき全面改修）

---

## 1. 設計の前提
POSL V1.1 では、以下の内容を基準として画面・データ・処理を設計する。

デフォルト週間テーマの管理とユーザー編集  
商品登録機能  
投稿コンテンツ管理機能  
鉄板イベント・独自イベント・今日は何の日イベントの管理と朝8時投稿  
既存の曜日テーマ画面・イベント管理画面は V1.1 仕様と乖離しているため、  
本設計書に基づき **全面的に再構築する。**

---

## 2. 曜日テーマ管理（設計）

### 概要
ユーザーが各曜日の投稿テーマを編集できる画面およびデータ構造を提供する。

### 初期テーマ値  
月 実績とストーリー  
火 ノウハウ  
水 商品紹介  
木 日記と人柄  
金 実績とお客様の声  
土 ライト投稿  
日 振り返りとまとめ  

### 画面構成
曜日一覧  
テーマ編集フィールド  
プレビュー表示  
保存ボタン  

### データ構造（例）
weekday_theme  
weekday（mon〜sun）  
theme_text  
updated_at  

### 動作
編集されたテーマは DB に保存され、  
「通常投稿の生成」に利用される。  
通常投稿はユーザー設定時間（例：20時）に投稿される。

### 改修方針  
現行の曜日テーマ設定画面は V1.1 設計と構造が異なるため、  
項目・ロジックを本設計に基づき改修する。

---

## 3. 商品登録機能（設計）

### 概要
商品宣伝に使用する商品マスタを管理する。

### 登録項目
商品名  
短文説明  
詳細説明  
カテゴリまたはタグ  
商品URL  
公開設定  
プロモーション優先度  

### 画面構成
商品一覧画面  
商品登録・編集画面  

### データ構造（例）
products  
title  
short_description  
description  
category  
url  
is_public  
priority  
created_at  
updated_at  

---

## 4. 投稿コンテンツ管理（設計）

### 概要
AI生成投稿と手動投稿を一元管理する。

### 管理項目
投稿内容  
関連する商品ID  
関連する曜日テーマ  
作成日・更新日  
ステータス（下書き／公開）  

### データ構造（例）
posts  
content  
product_id  
weekday  
status  
created_at  
updated_at  

### 動作
投稿は保存・編集可能。  
自動投稿はステータスが「公開」のものを使用する。

---

## 5. イベント機能（設計：全面刷新）

### 5.1 イベントの3分類（定義）
鉄板イベント  
独自イベント  
今日は何の日  

### 5.2 投稿時間
イベントは全て **朝8時** に投稿される。  
通常投稿とは別枠である。

### 5.3 イベントごとの仕様

#### 鉄板イベント
ネット上の年間行事データを元に登録される  
クリスマス、正月、ハロウィンなど  
出す／出さないのチェックボックス  
当日が対象なら朝8時に投稿  

#### 独自イベント
ユーザーが自由に登録する  
誕生日、記念日、自社イベントなど  
出す／出さないのチェックボックス  
当日なら朝8時に投稿  

#### 今日は何の日
外部データ（今日は何の日）を参照  
日付に対応した記念日  
出す／出さないのチェックボックス  
当日は朝8時に投稿  

### 5.4 データ構造（例）

events  
event_type（tetpan／user／today）  
title  
description  
date  
is_enabled  
created_at  
updated_at  

today_events（外部データ参照用）  
date  
title  
description  

### 5.5 投稿ロジック（朝8時）
朝8時に次を判定する。

鉄板イベント（有効）  
独自イベント（有効）  
今日は何の日（有効）  

該当するものが複数あればすべて投稿される。

### 改修方針  
現行イベント管理画面は「反映方法：追加/置換」など  
V1.1 の仕様と一致しないため、  
本設計書のイベント3分類方式に基づき **全面改修する。**

---

## 6. 画面構成（再構築版）

### 曜日テーマ管理画面  
テーマ一覧  
編集欄  
プレビュー  
保存

### 商品管理画面  
商品一覧  
商品登録  
商品編集  

### 投稿コンテンツ管理画面  
投稿一覧  
投稿作成  
投稿編集  

### イベント管理画面  
鉄板イベント一覧（ON/OFF）  
独自イベント一覧（追加・編集・ON/OFF）  
今日は何の日の ON/OFF  
朝8時投稿の説明  

---

## 7. 処理フロー（概要）

### 朝8時のイベント投稿フロー
イベントデータ取得  
→ 鉄板イベント判定  
→ 独自イベント判定  
→ 今日は何の日判定  
→ 有効イベントを全て投稿  

### 通常投稿フロー
ユーザー指定時刻に  
→ 曜日テーマを使用して投稿生成  
→ 投稿実行  

---

**本設計書に基づき、現行画面およびイベント処理は V1.1 に合わせ再構築する。**
