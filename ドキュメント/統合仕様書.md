# 📘 POSL（ポスエル）V1.0 仕様書・完全整理版

---

# 🎯 1. システム概要

POSLは「自分のX（旧Twitter）アカウントへ毎日1投稿、自動でAIが文章を生成し、決まった時間に投稿するパーソナル投稿AI」を目指したシステム。

AIが文章を作り、ユーザーの人格データ・日記・トレンド・曜日テーマを混ぜて自然で一貫性のある発信を継続できる仕組み。

V1はテキスト投稿のみ。

---

# 🔧 2. 主な機能一覧（V1）

## 2-1. 自動投稿機能
* X API（Freeプラン）を使用
* 1日1投稿
* 投稿時刻はデフォルト20:00（変更可能）
* **投稿ステータス監視機能**（Phase 4設計→Phase 6実装完了）
  - リアルタイム投稿状況表示（pending/processing/completed/failed）
  - 投稿履歴の管理・閲覧機能
  - 投稿エラー時の詳細情報表示

## 2-2. AI文章生成
* OpenAI GPT-4系を使用
* 投稿文は以下の素材から自動生成
  * 曜日テーマ
  * トレンドワード
  * イベント（季節・行事など）
  * 日記データ（音声→テキスト）
  * ユーザー人格プロファイル
  * 投稿テンプレ（文章の型）
  * 文体パラメータ（トーンや表現）
* AIにとって素材＝料理の食材、テンプレ＝レシピ、文体＝味付けのイメージ。
* **エラーハンドリング・リトライ機能**（Phase 4設計→Phase 6実装完了）
  - 指数バックオフによる自動再試行
  - 投稿生成失敗時の詳細ログ記録
  - 部分障害時の継続動作機能

## 2-3. 設定管理・同期機能（Phase 4設計→Phase 6実装完了）
* **リアルタイム設定同期**
  - フロントエンド⇔バックエンド設定の自動同期
  - 投稿時間・曜日テーマ・文体設定の即座反映
  - API通信エラー時の設定保護機能
* **設定データ永続化**
  - ローカルストレージとクラウドの双方向同期
  - オフライン時の設定保持機能

## 2-4. システム監視・ログ機能（Phase 4設計→Phase 6実装完了）
* **エラーログ監視**
  - システムエラーのリアルタイム表示
  - エラーレベル分類（error/warn/info）
  - 詳細エラー情報とスタックトレース表示
* **動作状況監視**
  - API接続状況の可視化
  - Node.js/Express サーバー実行ステータス追跡
  - パフォーマンス指標の表示

## 2-5. 曜日テーマ管理
* 曜日ごとに自動的に文章の方向性を変える。
* 例：
  * 月曜日：宣伝（商品・サービス）
  * 火曜日：役立つ知識
  * 水曜日：過去の失敗談
  * 木曜日〜日曜日：トレンド反応
* 調整は管理画面で変更可能

## 2-6. イベント投稿
* バレンタイン、クリスマス、お正月、誕生日、記念日
* 独自イベント追加も可能
* 該当日には通常投稿とは別テンプレで生成

## 2-7. トレンド取得（V1）
* Googleトレンド（PyTrends）
* Yahooトレンド（HTML/RSS）
* Yahooリアルタイム検索（HTML/RSS）
  → 軽く文章に混ぜる
* 商品宣伝に直結させない「薄めのトレンド融合作文」

## 2-8. 日記データ（音声入力）
* Whisper APIを使い音声→テキスト
* 日記は「人格データベース」に蓄積
* AIの文章に "あなたらしさ" を反映

## 2-9. 文体・トーンのカスタム
* 管理画面のコンボボックスで設定：
  * 丁寧 / 砕けた口調
  * ポジティブ / しっとり
  * ロマンチック / シンプル
  * 専門少なめ / 少し専門
  * ノスタルジック / カジュアル
  * 推論入れる / 入れない
  * 物語調（ゆったり）
  * 絵本のような優しいトーン
  * 目立つ派手さ / 控えめ
* 「文章の味付け」を細かく設定できるのがPOSLの強み。

## 2-10. 文章テンプレ（型）管理
* 初期搭載テンプレ（10型）：
  1. 共感スタート型
  2. 一言パンチライン型
  3. トレンド紐付け型
  4. ミニストーリー型
  5. ノウハウ1ポイント型
  6. 失敗談から学び型
  7. 今日の気づき型
  8. 雑談型
  9. イベント特化型
  10. 3ポイント型
* 「文章の骨格（型）」をユーザーが選択可能。
* 既存のSNS自動投稿ツールにはほぼ無い機能。

## 2-11. プロンプトエンジン
* 「テンプレ + 文体 + トレンド + 人格 + 日記」を合成するAI用プロンプト
* 管理画面で調整可能
* デフォルト設定へ戻すボタンあり
* ユーザー追加テンプレも可能
* POSLの要となる頭脳部分。

## 2-12. 投稿ログ
* 過去の投稿内容を保存
* 生成に使われた素材のパラメータも保存
* 実際にGPTに投げたプロンプト（入力）
* GPTのレスポンス（生成文）
* X APIのレスポンス（tweet_id など）

---

# 💻 3. 管理画面（UI仕様）

POSL管理画面の主な構成：

## 3-1. Dashboard
* 今日の投稿予定
* 今週の曜日テーマ
* 今日のトレンドTOP3
* 次のイベント
* API接続状況・自動投稿状況
* **投稿ステータス監視パネル**（PostStatusMonitor）
* **エラーログ監視パネル**（ErrorLogMonitor）

## 3-2. 自動投稿設定
* 投稿時間
* 自動投稿 ON/OFF
* API接続状態の確認

## 3-3. 曜日テーマ設定
* 各曜日の投稿ジャンル
* 優先度設定

## 3-4. イベント管理
* 既存のイベント一覧
* カスタムイベント追加

## 3-5. トレンド設定
* 取得するトレンドの種類
* 混ぜる割合（薄め〜濃いめ）

## 3-6. 文体・トーン設定
* 丁寧さ・カジュアルさ・ポジティブ度などのスライダー
* 禁止・注意表現の設定

## 3-7. 投稿テンプレ（型）設定
* テンプレ選択・有効化
* 優先度設定

## 3-8. プロンプト微調整
* 初期プロンプト方針の説明（読み取り専用）
* 文体・スタイル調整（文体・トーン設定へのリンク）
* テンプレ調整（テンプレ設定へのリンク）
* 追加ルール / NGワード（プロンプト微調整）
* デフォルト戻すボタン

## 3-9. 音声日記アップロード（日記管理）
* 音声アップロード
* 日記一覧
* 人格プロファイル生成

## 3-10. 人格データ閲覧
* あなたらしさの要約表示
* 性格傾向の可視化

## 3-11. 投稿ログ
* 過去の投稿履歴
* 生成に使われた素材情報

## 3-12. API設定
* X API設定（Key/Secret/Token）
* OpenAI API設定

---

# 🏗 4. システム構成（Phase 6移行完了版）

現在のPOSL V1アーキテクチャ（2025年11月17日現在）：

## 開発・本番環境構成

### **Phase 6完了：MySQL移行アーキテクチャ**

## Node.js バックエンドサーバー
* **開発環境**: Serverless Offline（localhost:3001）
* **本番環境**: EC2/Docker Container推奨
* Express.js ベースAPI
* 投稿生成処理
* トレンド収集
* 日記変換（Whisper API統合）
* 自動スケジューリング（node-cron）

## MySQL 8.0データベース
* **開発環境**: Docker Container（localhost:3307）
* **本番環境**: AWS RDS MySQL 8.0推奨
* 全設定データ（settings テーブル）
* ユーザー管理（users テーブル）
* 投稿ログ（post_logs テーブル）
* 日記データ（diaries テーブル）
* 人格プロファイル（persona_profiles テーブル）

## スケジュール管理
* **node-cron**による内部スケジューリング
* デフォルト：毎日20時に自動投稿
* ユーザー設定可能な投稿時刻
* ~~EventBridge（非使用）~~

## API構成
* **開発環境**: 直接Express.js（localhost:3001）
* **本番環境**: ALB + ECS/EC2推奨
* ~~API Gateway（Phase 6で置換）~~

### **現在のAPIエンドポイント**
* **/local/settings/{settingType}** - 設定管理API
  - Method: GET/PUT
  - MySQL settingsテーブル連携
  - 曜日テーマ、文体、テンプレート等の管理

* **/local/posts/status** - 投稿ステータス監視API
  - Method: GET
  - パラメータ: limit, status（フィルタリング用）
  - レスポンス: 投稿一覧（ステータス、タイムスタンプ、エラー情報含む）
  - 用途: PostStatusMonitorコンポーネントでのリアルタイム監視

* **/local/posts/update-status** - 投稿ステータス更新API  
  - Method: POST
  - パラメータ: post_id, status, error_message（オプション）
  - レスポンス: 更新結果ステータス
  - 用途: 投稿プロセス進行に合わせたステータス更新

### **ErrorLog API（システム監視）** ✅ NEW
* **/local/errors/logs** - エラーログ管理API
  - Method: GET  
    - パラメータ: limit (1-100, デフォルト: 10)
    - レスポンス: エラーログ一覧（id, timestamp, level, message, source, details）
    - 用途: ErrorLogMonitorコンポーネントでのリアルタイム監視
  - Method: DELETE
    - 機能: 全エラーログの一括削除
    - レスポンス: 削除件数とステータス
    - 用途: ログメンテナンス

### **System Health API（システム状態監視）**
* **/local/system/health** - システム全体ヘルスチェック
  - Method: GET  
  - レスポンス: DB接続状況、API連携状態、実行中タスク状況
  - 用途: PostStatusMonitorコンポーネントでの稼働監視

* **/local/system/errors** - システムエラーログAPI
  - Method: GET  
  - パラメータ: level, limit, from_date
  - レスポンス: エラーログ一覧（レベル、タイムスタンプ、メッセージ）
  - 用途: ErrorLogMonitorコンポーネントでのエラー監視

## 補助サービス

### **MinIO（S3互換ストレージ）**
* **開発環境**: Docker Container（localhost:9000/9001）
* **本番環境**: AWS S3またはMinIOクラスター
* 音声データ保存
* 日記原文アーカイブ

### **DynamoDB Local（開発用補助）**
* **開発環境のみ**: Docker Container（localhost:8000）
* **本番環境**: ~~使用せず（MySQL完全移行）~~
* 開発・テスト用途のみ保持

### **Secrets Management**
* **開発環境**: 環境変数（.env）
* **本番環境**: AWS Secrets Manager推奨
* X APIキー
* OpenAI APIキー
* MySQL接続情報

---

# 🔗 5. 外部API

* X API（投稿用）
* OpenAI GPT-4系（文章生成）
* OpenAI Whisper（音声→テキスト）
* Googleトレンド（PyTrends）
* Yahooトレンド（RSS/HTML）

---

# 🎨 6. ブランド / デザイン仕様

## ロゴ
* 採用ロゴ：右端のバージョン（POSL）
* シンプル・信頼感・優しい印象

## カラーパレット
* Midnight Blue (#1B1E3C)
* Neo Mint Green (#D1FFE6)
* Soft White (#FAFAFA)
* Accent Pink (#FF55AA)

## グラデーション案
* Blue → Mint
* Pink → Mint

---

# 🧠 7. 今後の拡張（V1.1 / V2）

## V1.1
* 画像生成（Midjourney / Stability API / Runway）
* 画像付き投稿

## V2
* Instagram / Facebook / LinkedIn 投稿対応
* プラットフォームごとに文章テンプレを切り替え

---

# 📝 8. POSL V1 ミッションまとめ

* Xに毎日1投稿
* あなたらしい文体
* AIがあなたの分身のように書く
* 日記と人格で進化
* トレンドも軽く拾う
* 管理画面は分かりやすく
* プロンプトはいつでも調整可能

POSLは「SNS運用 × AI × パーソナルデータ」をひとつにまとめたツール。

---

# 📐 Phase 6完了 - アーキテクチャ変更履歴

## レガシー構成（Phase 1-5）
```
AWS Lambda + EventBridge + DynamoDB + API Gateway
```
→ サーバーレス構成、コールド起動問題、DynamoDB料金課題

## 現在構成（Phase 6完了）
```
Node.js + Express + MySQL + Cron Scheduler
```
→ 常駐型高速レスポンス、フル機能MySQL、コスト最適化

## 主要変更点
1. **DynamoDB → MySQL**: 完全移行、MySQLHelper実装
2. **Lambda → Node.js**: Serverless Offline開発、本番EC2推奨
3. **EventBridge → node-cron**: アプリケーション内スケジューラー
4. **API Gateway → Express**: 直接HTTP API、開発効率向上

---

# 🚀 実装進捗ステータス（2025年11月17日 - OpenAI API統合完了）

## Phase 6 MySQL移行 ✅ **完全完了**

### ✅ 基盤移行・開発環境復旧完了
- **MySQL 8.0環境**: Docker Compose統合完了、接続テスト成功
- **MySQLHelper実装**: DynamoDB互換API完全実装・動作確認済み
- **PromptEngine移行**: MySQL対応完了（8設定取得メソッド）
- **TypeScript環境**: 非推奨警告修正、ビルドエラー全解消
- **フルスタック起動**: バックエンド(3001)・フロントエンド(3000)正常稼働

### ✅ OpenAI API統合完了 🎉 **NEW**
- **実際のAPIキー設定**: sk-proj-****AZXL6san8A 認証成功
- **環境変数読み込み**: dotenv統合・useDotenv: true設定完了
- **プロンプト生成機能**: 実際のGPT-4 API通信成功
- **実行パフォーマンス**: 4-9秒でプロンプト生成完了
- **エラーハンドリング**: 指数バックオフ・リトライ機能実稼働

### ✅ 現在稼働中の機能
- **Node.js開発サーバー**: Serverless Offline on localhost:3001
- **MySQL設定管理**: settings テーブル完全対応
- **実環境プロンプト生成**: OpenAI GPT-4実際のAPI応答取得
- **文体カスタマイズ**: 全10種類トーン対応済み
- **Next.js UI**: React管理画面 on localhost:3000

### 🎯 Phase 7 - 外部API統合（次期フェーズ）
- **X API統合**: 実際の投稿機能実装（フロントエンド完成後推奨）
- **音声日記**: Whisper API統合とファイルアップロード
- **トレンド取得**: Google/Yahoo Trends統合
- **スケジューラー**: node-cronによる自動投稿システム
- **本番環境**: Docker/ECS本番デプロイ準備

### 📊 最新進捗状況
**Phase 6: 100%完了** ✅  
**OpenAI API統合: 100%完了** ✅  
**Phase 7: 準備完了** 🚀  
**開発環境: 完全稼働中** ⚡  
**実装進捗: 70%** (OpenAI統合完了により大幅進展)

---

# 🏆 Phase 6完了記録
**MySQL完全移行アーキテクチャ構築成功**
- DynamoDB → MySQL移行完了
- Legacy AWS構成 → モダンNode.js構成移行完了  
- 開発環境フルスタック復旧完了
- 次期フェーズ開発準備完了
