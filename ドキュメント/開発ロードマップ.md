# 🚀 POSL V1.0 開発ロードマップ

---

## 1. 開発概要

### 1-1. プロジェクト目標
- **期間**: 約3-4ヶ月（フルタイム1-2名想定）
- **技術スタック**: AWS Serverless + Next.js + TypeScript
- **リリース目標**: MVP版でのβテスト開始

### 1-2. 開発原則
- 設計書との完全整合性を保つ
- 段階的リリース（MVP → 機能追加）
- テストドリブン開発
- セキュリティファースト

---

## 2. フェーズ別開発計画

### Phase 0: 準備フェーズ（1-2週間）

#### 環境戦略（シンプル2環境）
- **ローカル開発環境**: Docker構成でコスト0・高速開発
- **本番環境**: AWS本番構成（開発完了後に構築）

※ステージング環境は省略し、ローカル→本番の2段階でシンプルに

#### AWS本番環境構築（必要時のみ）
- [ ] 本番用AWS環境（開発完了後に構築）
  - [ ] AWS CLI設定
  - [ ] IAMロール・ポリシー設計（本番用：セキュリティ重視）
  - [ ] 命名規則：`posl-prod-*`
- [ ] DynamoDB構築（本番用）
  - [ ] テーブル設計実装
  - [ ] プロビジョンドモード + Auto Scaling
  - [ ] インデックス最適化
- [ ] S3バケット構築（本番用）
  - [ ] 音声ファイル保存用バケット（`posl-prod-audio-bucket`）
  - [ ] 本番セキュリティ設定
- [ ] Secrets Manager設定（本番用）
  - [ ] 本番APIキー管理
  - [ ] 実際のAPI認証情報

#### ローカル開発環境準備
- [ ] Docker環境構築
  - [ ] Docker + Docker Compose設定
  - [ ] DynamoDB Local コンテナ
  - [ ] S3互換ストレージ（MinIO）コンテナ
  - [ ] Next.js開発サーバーコンテナ
  - [ ] Node.js（Lambda関数開発）コンテナ
- [ ] GitHubリポジトリ作成
- [ ] CI/CDパイプライン設計
- [ ] ローカル⇔AWS環境の切り替え仕組み
- [ ] ESLint/Prettier設定
- [ ] VSCode設定（devcontainer対応）

#### AWS開発環境構築（クラウドテスト用）

### Phase 1: バックエンド基盤（2-3週間）

#### 1-1. Lambda基盤構築
- [ ] Serverless Framework or AWS CDK選定・セットアップ
- [ ] Lambda共通ライブラリ作成
  - [ ] DynamoDB接続ヘルパー
  - [ ] S3接続ヘルパー
  - [ ] Secrets Manager接続ヘルパー
  - [ ] エラーハンドリング

#### 1-2. 外部API連携実装
- [ ] OpenAI API連携
  - [ ] GPT-4 Chat Completions実装
  - [ ] Whisper API実装
  - [ ] レート制限対応
- [ ] X API連携
  - [ ] OAuth1.0a認証実装
  - [ ] POST /2/tweets実装
  - [ ] エラーレスポンス処理
- [ ] トレンド取得API実装
  - [ ] Google Trends (PyTrends)
  - [ ] Yahoo Trends/リアルタイム検索

#### 1-3. データベース操作層
- [ ] DynamoDB CRUD操作実装
  - [ ] Users管理
  - [ ] 投稿ログ管理
  - [ ] 設定管理（曜日テーマ、文体等）
  - [ ] 日記・人格データ管理

---

### Phase 2: API Gateway + Lambda関数（2-3週間）

#### 2-1. API設計・実装
- [ ] API Gateway設定
- [ ] 各エンドポイント実装
  ```
  POST /settings/post-time
  GET/PUT /settings/week-theme
  GET/PUT /settings/event
  GET/PUT /settings/trend
  GET/PUT /settings/tone
  GET/PUT /settings/template
  GET/PUT /settings/prompt
  POST /diary/upload
  GET /diary/list
  GET /post/logs
  POST /test/post
  ```

#### 2-2. 認証・認可実装
- [ ] APIキー認証
- [ ] ユーザーセッション管理
- [ ] CORS設定

#### 2-3. プロンプトエンジン実装
- [ ] プロンプト生成ロジック
  - [ ] テンプレ10種の実装
  - [ ] tone_profile数値→文言変換
  - [ ] 素材合成ロジック
- [ ] 投稿生成Lambda
  - [ ] 曜日テーマ判定
  - [ ] イベント判定
  - [ ] トレンド取得・フィルタリング
  - [ ] プロンプト生成→GPT呼び出し
  - [ ] 投稿実行・ログ保存

---

### Phase 3: フロントエンド開発（3-4週間）

#### 3-1. Next.js基盤構築
- [ ] Next.js + TypeScript + Tailwind CSS環境構築
- [ ] 共通コンポーネント作成
  - [ ] Layout
  - [ ] Navigation
  - [ ] Card
  - [ ] Button
  - [ ] Form elements
- [ ] 状態管理実装（Zustand or Redux Toolkit）

#### 3-2. UI画面実装
- [ ] 1. Dashboard
  - [ ] 今日の投稿予定表示
  - [ ] トレンドTOP3表示
  - [ ] 次のイベント表示
  - [ ] API接続状況表示
- [ ] 2. 自動投稿設定
  - [ ] 投稿時間設定（時刻ピッカー）
  - [ ] 自動投稿ON/OFF切替
  - [ ] API接続テスト
- [ ] 3. 曜日テーマ設定
  - [ ] 曜日ごとの編集フォーム
  - [ ] プレビュー生成機能
- [ ] 4. イベント管理
  - [ ] イベント一覧表示
  - [ ] カスタムイベント追加
  - [ ] 挙動設定（追加/置換）
- [ ] 5. トレンド設定
  - [ ] 取得元選択
  - [ ] 混ぜ方スライダー
  - [ ] 避けたいカテゴリ設定

#### 3-3. 高度UI実装
- [ ] 6. 文体・トーン設定
  - [ ] 7つのスライダー実装
  - [ ] リアルタイムプレビュー
  - [ ] プリセット切替
- [ ] 7. 投稿テンプレ設定
  - [ ] テンプレ10種の選択UI
  - [ ] 優先度ドラッグ&ドロップ
- [ ] 8. プロンプト微調整
  - [ ] 追加ルール入力
  - [ ] NGワード管理
  - [ ] 好きな表現管理
- [ ] 9. 音声日記アップロード
  - [ ] ファイルアップロード
  - [ ] 録音機能（ブラウザ対応）
  - [ ] 変換ステータス表示
  - [ ] 日記一覧・再生

#### 3-4. その他UI
- [ ] 10. 人格データ閲覧
  - [ ] 人格要約表示
  - [ ] 性格傾向グラフ
- [ ] 11. 投稿ログ
  - [ ] 投稿履歴一覧
  - [ ] プロンプト詳細表示
  - [ ] Xリンク
- [ ] 12. API設定
  - [ ] APIキー設定フォーム
  - [ ] 接続テスト機能

---

### Phase 4: スケジューラー + EventBridge（1週間）

#### 4-1. 自動投稿システム実装
- [ ] EventBridge Scheduler設定
- [ ] 投稿生成Lambda（毎日20:00実行）
- [ ] エラーハンドリング・リトライ機能
- [ ] 実行ログ・モニタリング

#### 4-2. 日記処理システム
- [ ] 音声アップロード時のWhisper処理Lambda
- [ ] 人格プロファイル更新Lambda
- [ ] 定期的な人格要約更新（週次）

---

### Phase 5: テスト + 最適化（2週間）

#### 5-1. テスト実装
- [ ] ユニットテスト
  - [ ] プロンプト生成ロジック
  - [ ] tone_profile変換
  - [ ] API接続部分
- [ ] 統合テスト
  - [ ] 投稿生成→X投稿の流れ
  - [ ] 音声→日記→人格更新の流れ
- [ ] E2Eテスト
  - [ ] UI操作→API呼び出し→結果表示

#### 5-2. パフォーマンス最適化
- [ ] Lambda Cold Start対策
- [ ] DynamoDB クエリ最適化
- [ ] フロントエンド バンドルサイズ最適化
- [ ] 画像・リソース最適化

#### 5-3. セキュリティ監査
- [ ] APIエンドポイント脆弱性チェック
- [ ] 認証・認可フロー確認
- [ ] 秘密情報の漏洩チェック
- [ ] CORS設定確認

---

### Phase 6: 本番デプロイ（1週間）

#### 6-1. 本番環境構築
- [ ] 本番用AWSリソース構築
  - [ ] 高可用性構成（`posl-prod-*`）
  - [ ] 本番用セキュリティ設定（厳格）
- [ ] ドメイン・SSL・CDN設定
  - [ ] ドメイン取得・SSL証明書設定
  - [ ] CloudFront配信設定
  - [ ] Route 53 DNS設定
- [ ] 本番デプロイ・リリース
  - [ ] ローカル→本番の直接デプロイ
  - [ ] 段階的リリース計画

#### 6-2. モニタリング・運用体制
- [ ] 本番モニタリング設定
  - [ ] CloudWatch設定
  - [ ] アラート設定（重要な障害のみ）
  - [ ] ログ集約・分析環境
  - [ ] エラー通知設定
- [ ] 運用準備
  - [ ] 本番バックアップ戦略
  - [ ] 障害対応手順書
  - [ ] 運用マニュアル作成

---

## 3. 技術スタック詳細

### 3-1. バックエンド
- **AWS Lambda**: Node.js 18.x (TypeScript)
- **API Gateway**: REST API
- **DynamoDB**: NoSQL データベース
- **S3**: オブジェクトストレージ
- **EventBridge**: スケジューラー
- **Secrets Manager**: APIキー管理
- **CloudWatch**: ログ・モニタリング

### 3-2. フロントエンド
- **Next.js 14**: React フレームワーク
- **TypeScript**: 型安全性
- **Tailwind CSS**: スタイリング
- **Zustand**: 状態管理
- **React Hook Form**: フォーム管理
- **Recharts**: グラフ・チャート

### 3-3. 外部サービス
- **OpenAI API**: GPT-4, Whisper
- **X API**: 投稿機能
- **Google Trends API**: トレンド取得
- **Yahoo APIs**: トレンド取得

### 3-4. 開発ツール
- **Serverless Framework**: インフラ管理
- **Jest**: テストフレームワーク
- **ESLint/Prettier**: コード品質
- **GitHub Actions**: CI/CD

---

## 4. 環境構築戦略（シンプル2環境）

### 4-1. ローカル開発環境（Docker構成）
- **目的**: 日常的な開発・UI確認・基本機能テスト
- **コスト**: 0円（ローカルマシンのみ）
- **技術**: Docker Compose
- **アクセス**: `http://localhost:3000` でブラウザ確認可能
- **構成**:
  ```yaml
  # docker-compose.yml
  services:
    dynamodb-local:
      image: amazon/dynamodb-local
      ports: ["8000:8000"]
    
    minio:  # S3互換
      image: minio/minio
      ports: ["9000:9000", "9001:9001"]
    
    nextjs:
      build: ./frontend
      ports: ["3000:3000"]
      volumes: ["./frontend:/app"]
    
    lambda-dev:
      build: ./backend
      ports: ["3001:3001"]
      volumes: ["./backend:/app"]
  ```

### 4-2. 本番環境（AWS構成）
- **目的**: 実際のサービス提供
- **コスト**: 最適化（Reserved Instance等活用）
- **セキュリティ**: 最高レベル
- **リソース命名**: `posl-prod-*`
- **データ**: 実データ

### 4-3. 開発フロー（シンプル）
```
1. ローカル開発（Docker）
   ↓ 機能完成・テスト完了
2. 本番デプロイ
   ↓ リリース
```

### 4-4. 環境間の違い

| 項目 | ローカル | 本番 |
|---|---|---|
| DynamoDB | DynamoDB Local | プロビジョンド + Auto Scaling |
| S3 | MinIO | AWS S3 |
| Lambda | ローカル実行 | 最適化済みLambda |
| 外部API | モック/テスト用 | 本番API |
| モニタリング | なし | 詳細 + アラート |
| ドメイン | localhost:3000 | 独自ドメイン |
| SSL | なし | Let's Encrypt/AWS Certificate |

---

## 5. リスク管理・対策

### 4-1. 技術リスク
- **外部API制限**: レート制限・障害時の代替手段
- **Lambda制限**: 実行時間・メモリ制限の監視
- **DynamoDB制限**: スループット・容量の監視

### 4-2. 開発リスク
- **スコープクリープ**: 設計書から逸脱しない厳格管理
- **品質リスク**: テストカバレッジ80%以上維持
- **納期リスク**: 週次進捗レビュー・早期リスク特定

### 4-3. 運用リスク
- **セキュリティ**: 定期的な脆弱性診断
- **可用性**: 多AZ構成・障害対応手順
- **コスト**: 月次使用量監視・予算アラート

---

## 5. 成功指標（KPI）

### 5-1. 開発KPI
- [ ] 設計書との仕様適合率: 100%
- [ ] テストカバレッジ: 80%以上
- [ ] ページロード時間: 3秒以内
- [ ] API応答時間: 500ms以内

### 5-2. 品質KPI
- [ ] バグ発生率: 週次1件以内
- [ ] 可用性: 99.5%以上
- [ ] セキュリティ脆弱性: 0件

### 5-3. ユーザビリティKPI
- [ ] UI操作完了率: 95%以上
- [ ] エラー画面遭遇率: 5%以内
- [ ] ユーザー満足度: 4.0/5.0以上

---

## 6. 次フェーズ（V1.1）準備

### 6-1. 画像生成機能準備
- [ ] Midjourney/Stability API調査
- [ ] 画像付き投稿API設計
- [ ] 画像ストレージ戦略

### 6-2. 多プラットフォーム対応準備
- [ ] Instagram API調査
- [ ] Facebook API調査
- [ ] プラットフォーム抽象化設計

---

このロードマップに沿って開発を進めることで、設計書に完全準拠したPOSL V1.0を確実にリリースできます。