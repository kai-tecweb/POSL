# POSL開発ルール

作成日: 2025-11-25
バージョン: 1.0.0

## 1. 開発環境

### 開発フロー

```
ローカル（開発）
    ↓ git push
GitHub（コード管理）
    ↓ git pull + build + restart
EC2（本番）
```

### 各環境の役割

| 環境 | 役割 | やること |
|------|------|----------|
| ローカル | 開発 | コード編集、テスト、git push |
| GitHub | コード管理 | バージョン管理、履歴保持 |
| EC2 | 本番運用 | git pull、ビルド、サービス起動 |

### ディレクトリ構成

**ローカル:**

```
~/POSL/
├── backend/
├── frontend/
├── infrastructure/
├── ドキュメント/
├── CLAUDE.md
└── README.md
```

**EC2（本番）:**

```
/home/ubuntu/POSL-repo/    ← 本番で使用するディレクトリ
├── backend/
├── frontend/
├── infrastructure/
├── ドキュメント/
├── CLAUDE.md
└── README.md

# 以下は廃止予定（使用しない）
/home/ubuntu/backend/      ← 廃止予定
/home/ubuntu/frontend/     ← 廃止予定
```

### デプロイ手順

#### ローカルでの作業

```bash
# 1. 変更をコミット
git add .
git commit -m "[種類] 変更内容"

# 2. GitHubにプッシュ
git push origin main
```

#### EC2での作業

```bash
# 1. SSH接続
ssh -i ~/.ssh/posl-production-key.pem ubuntu@18.179.104.143

# 2. リポジトリに移動してpull
cd /home/ubuntu/POSL-repo
git pull origin main

# 3. フロントエンドビルド
cd frontend
npm install
npm run build

# 4. PM2再起動
pm2 restart posl-frontend
pm2 restart posl-api

# 5. 動作確認
pm2 list
curl http://localhost:3001/health
```

### 禁止事項

- ❌ EC2で直接コード編集しない
- ❌ /home/ubuntu/backend/ や /home/ubuntu/frontend/ を使用しない
- ❌ git pull せずにファイルを直接コピーしない

---

## 2. Git運用ルール

### ブランチ戦略
- 基本は `main` のみ
- 大きな変更時のみ `feature/xxx` を作成

### コミットルール
- 1つの作業完了 → コミット
- 1日の終わり → 必ずコミット＆プッシュ

### メッセージ形式
```
[種類] 変更内容

種類: [機能追加] [修正] [改善] [設定] [ドキュメント]
```

### プッシュルール
- コミットしたら早めにプッシュ
- 10コミット以上溜めない

---

## 3. リカバリー手順

### 変更前（必須）
```bash
git rev-parse HEAD > /tmp/before_hash.txt
```

### 戻し方
```bash
# コミット前の変更を取り消し
git checkout -- ファイル名

# コミット後に戻す
git reset --hard [ハッシュ]

# サーバー再起動
pkill -f simple_final_api.js
cd /home/ubuntu/backend && node simple_final_api.js &
```

---

## 4. 命名規則

### ファイル名

| 種類 | 形式 | 例 |
|------|------|-----|
| APIファイル | kebab-case | post-scheduler.js |
| コンポーネント | PascalCase | PostScheduler.tsx |
| 設定 | kebab-case | db-config.js |

### 禁止事項
- `xxx_backup.js` - どれが最新かわからなくなる
- `xxx_old.js` - 同上
- `xxx_v2.js` - 同上
- `xxx_test.js` - 一時ファイル放置
- `simple_final_xxx.js` - 意味不明
- `new_xxx.js` - 曖昧

### ルール
- 機能がわかる名前をつける
- 一時ファイルは作ったらすぐ削除
- backup、old、v2 等を作らない
- 最新版のみ存在する状態を維持

### 変数・関数名

| 種類 | 形式 | 例 |
|------|------|-----|
| 変数 | camelCase | postContent |
| 関数 | camelCase | generatePost() |
| 定数 | UPPER_SNAKE | MAX_RETRY |

---

## 5. フォルダ管理ルール

### フォルダ構造
```
POSL/
├── backend/              # バックエンドコード
├── frontend/             # フロントエンドコード
├── infrastructure/       # AWS設定・Terraform
├── ドキュメント/          # ドキュメント（日本語ファイル名OK）
│   ├── 仕様書/
│   ├── 設計書/
│   ├── 運用手順/
│   └── 議事録/
└── scripts/              # 実行スクリプト
```

### ルール

| 種類 | 置き場所 | ファイル名 |
|------|----------|-----------|
| コード | backend/ frontend/ | 英語（kebab-case） |
| ドキュメント | ドキュメント/ | 日本語OK |
| 設定 | infrastructure/ | 英語 |
| スクリプト | scripts/ | 英語（kebab-case） |

### 禁止事項
- ルート直下にドキュメント散乱
- コードフォルダにドキュメント混在
- archive/、old/ フォルダ作成
- 同じ内容のファイルを複数箇所に

---

## 6. Claude Code指示ルール

### 基本原則
調査と実装は分ける

```
1. 調査依頼 → 結果確認
2. 実装判断 → 承認
3. 実装依頼 → 実行
4. 確認 → コミット＆プッシュ
```

### 指示文テンプレート

#### 調査時
```
⚠️ 調査のみ。コード変更は絶対にしない。

## 調査: [タイトル]
- 確認してほしいこと
- 出力形式: 現状報告、問題点、修正案（提案のみ）
```

#### 実装時
```
## 実装: [タイトル]

### 変更内容
- xxx

### 制約
- 一時ファイル・バックアップを作らない
- 既存ファイルを直接修正
- 変更後にgit diff表示
```

### Claude Codeへの禁止事項
- バックアップファイル作成
- `_old`、`_backup` 作成
- 勝手に実装まで進む

---

