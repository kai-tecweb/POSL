/**
 * イベントプロンプト生成サービス
 * POSL V1.1 Phase 1: イベント投稿機能
 * 
 * 機能:
 * - イベント投稿用プロンプト生成
 * - 鉄板イベント用テンプレート
 * - 今日は何の日用テンプレート
 */

/**
 * イベント投稿用プロンプトを生成
 * @param {Object} event - イベントオブジェクト
 * @param {Object} userProfile - ユーザープロファイル（オプション）
 * @returns {Object} { systemPrompt, userPrompt }
 */
function generateEventPrompt(event, userProfile = null) {
  const { event_type, title, description } = event;
  
  // システムプロンプト（共通）
  const systemPrompt = `あなたは、ユーザー本人の「分身」としてX（旧Twitter）に投稿する日本語文章を作るAIです。

▼基本方針
- 読んだ人が少し前向きになるような内容にしてください。
- 売り込み感や宣伝感を強く出しすぎないでください。
- 専門用語はできるだけ少なくし、使う場合は短い補足説明を入れてください。
- 毎回の投稿は1つのツイート内で完結させてください（連投前提の構成は禁止）。

▼文量・形式
- 140文字前後を目安とし、最大でも280文字以内に収めてください。
- 絵文字は使っても1個までにしてください。
- ハッシュタグは2-3個まで使用可能です。自然に組み込んでください。

▼文体・口調
- 「です・ます調」で統一してください。
- やや丁寧だが、堅すぎない口調で書いてください。
- 全体として前向きで、読んだ人がほっとするような雰囲気を目指してください。
- 一人称は「私」を使ってください。

▼NG事項
- 暴力、差別、政治、宗教、誹謗中傷に関する内容は書かないでください。
- 不安や恐怖を煽るような表現は避けてください。

以上のルールを必ず守りながら、後続の指示（ユーザーメッセージ）に従って投稿文を1つだけ生成してください。`;

  // ユーザープロンプト（イベントタイプ別）
  let userPrompt = "";
  
  if (event_type === 'fixed') {
    // 鉄板イベント用テンプレート
    userPrompt = `# イベント投稿: ${title}

${description ? `イベント説明: ${description}\n` : ''}

以下の条件で投稿文を作成してください：

1. イベントの雰囲気を伝える
   - 季節感や特別感を表現
   - 読者が「そうそう、今日は◯◯だね」と共感できる内容

2. ポジティブなメッセージ
   - 祝福や感謝の気持ちを込める
   - 読者が前向きになれる内容

3. 自然なハッシュタグ
   - イベント名に関連するハッシュタグを2-3個自然に組み込む
   - 例: #${title.replace(/\s+/g, '')} #今日は何の日

4. 文字数
   - 140文字前後（最大280文字以内）

# 出力フォーマット
- Xにそのまま投稿できる本文だけを出力してください。
- 前後に説明文やラベルはつけず、日本語の文章1本のみを出力してください。`;
    
  } else if (event_type === 'today') {
    // 今日は何の日用テンプレート
    userPrompt = `# 今日は何の日: ${title}

${description ? `説明: ${description}\n` : ''}

以下の条件で投稿文を作成してください：

1. 「今日は◯◯の日」という事実を自然に伝える
   - 硬いニュース調ではなく、親しみやすい表現

2. 個人的な感想や気づきを添える
   - 「こんな日があるんだな」という発見
   - 読者と共有できる小さな気づき

3. 軽やかなトーン
   - 重くならないように
   - 読者が「へぇ、そうなんだ」と思える内容

4. 自然なハッシュタグ
   - #今日は何の日 などのハッシュタグを2-3個自然に組み込む

5. 文字数
   - 140文字前後（最大280文字以内）

# 出力フォーマット
- Xにそのまま投稿できる本文だけを出力してください。
- 前後に説明文やラベルはつけず、日本語の文章1本のみを出力してください。`;
    
  } else if (event_type === 'personal') {
    // パーソナルイベント用テンプレート
    userPrompt = `# パーソナルイベント: ${title}

${description ? `説明: ${description}\n` : ''}

以下の条件で投稿文を作成してください：

1. 個人的な思い出や感謝を表現
   - 特別な日への想い
   - 関係者への感謝

2. 読者にも共感してもらえる内容
   - 個人的でありながら、読者も「そういう気持ち、わかる」と思える内容

3. 温かみのある表現
   - 心が温まるような言葉選び
   - 読者がほっとする雰囲気

4. 自然なハッシュタグ
   - イベントに関連するハッシュタグを2-3個自然に組み込む

5. 文字数
   - 140文字前後（最大280文字以内）

${userProfile ? `\n# ユーザープロファイル参考情報\n${JSON.stringify(userProfile, null, 2)}\n` : ''}

# 出力フォーマット
- Xにそのまま投稿できる本文だけを出力してください。
- 前後に説明文やラベルはつけず、日本語の文章1本のみを出力してください。`;
  }
  
  return {
    systemPrompt,
    userPrompt
  };
}

module.exports = {
  generateEventPrompt
};

