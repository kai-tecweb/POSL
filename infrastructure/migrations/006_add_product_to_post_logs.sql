-- ============================================================
-- POSL V1.1 Phase 2-4: post_logsテーブルに商品投稿対応を追加
-- ============================================================
-- 作成日: 2025-11-25
-- 目的: post_logsテーブルに商品投稿機能のためのカラムとENUM値を追加
-- 実行順序: 001 → 002 → 003 → 004 → 005 → 006
-- 前提: 001-005が実行済みであること
-- ============================================================

USE posl_db;

-- ============================================================
-- 1. product_idカラムを追加
-- ============================================================
-- 役割: 商品投稿の場合の商品IDを記録
-- 位置: event_idの後
ALTER TABLE post_logs
ADD COLUMN product_id INT NULL COMMENT '商品投稿の場合の商品ID（products.idへの参照）'
AFTER event_id;

-- ============================================================
-- 2. product_idのインデックスを追加
-- ============================================================
-- 役割: 商品IDでの検索を高速化
CREATE INDEX idx_post_logs_product ON post_logs(product_id);

-- ============================================================
-- 3. post_type ENUMにproductを追加
-- ============================================================
-- 役割: 商品投稿を区別できるようにする
ALTER TABLE post_logs
MODIFY COLUMN post_type ENUM('normal','event','product') NULL
COMMENT '投稿タイプ: normal=通常投稿, event=イベント投稿, product=商品投稿';

-- ============================================================
-- 確認
-- ============================================================
DESCRIBE post_logs;

